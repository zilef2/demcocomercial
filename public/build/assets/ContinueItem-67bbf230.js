import{k as te,j as oe,z as f,h as z,p as F,A as ae,q as se,f as d,b as o,t as p,v as h,B as b,e as T,g as u,c as k,F as j,m as re,u as m,a as x,w as Z,s as ie,o as i,n as ne,d as y}from"./app-551012d8.js";import{_ as le}from"./TextInput-4b8270d6.js";/* empty css             */import ce from"./Add_Sub_equipos-f939d446.js";import{n as _,a as pe}from"./global-6d1c7c87.js";/* empty css                   */import{C as de}from"./vue-select.es-e7a5a940.js";import{_ as P}from"./InputError-23c0a787.js";import{_ as ue}from"./FactorModal-3003c42d.js";import{_ as me}from"./PrimaryButton-bd076b11.js";import{r as _e}from"./PencilIcon-7035d21d.js";import"./Modal-e8455b5b.js";import"./SecondaryButton-ec5b0153.js";const he={key:0,class:"text-center mx-auto mt-6 mb-2 relative drop-shadow-xl min-w-[680px] h-12 overflow-hidden rounded-xl bg-gray-800"},xe=["id"],ye={class:"text-center text-lg mx-2 w-32"},we=o("div",{class:"absolute w-56 h-48 bg-white blur-[50px] -left-1/2 -top-1/2"},null,-1),ge={class:"p-4 mb-6 grid-cols-2 gap-4 overflow-x-scroll xs:min-w-[700px] md:min-w-[1500px] 2xl:min-w-[1800px] bg-gray-50 dark:bg-gray-900 border-x-[2px] border-gray-300 dark:border-indigo-700 rounded-xl hover:shadow-indigo-300/50 dark:hover:shadow-indigo-700/50 transition-all duration-500 ease-in-out"},fe={class:"overflow-x-auto divide-y-1 divide-gray-200 w-full dark:text-gray-100"},be=o("thead",{class:"ltr:text-left rtl:text-right w-full"},[o("tr",{class:"*:font-medium bg-gray-900 text-white shadow-md rounded-xl dark:text-gray-100"},[o("th",{class:"px-3 py-2 whitespace-nowrap rounded-l-2xl dark:text-gray-100"},"#"),o("th",{class:"px-3 py-2 mx-2 min-w-[10px] dark:text-gray-100"},"Código"),o("th",{class:"px-3 py-2 mx-2 whitespace-nowrap min-w-[150px] max-w-[850px] dark:text-gray-100"}," Descripción "),o("th",{class:"-px-1 py-2 whitespace-nowrap max-w-[110px] dark:text-gray-100"},"Cantidad"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Precio de lista"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Descuentos"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Descuento final %"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Costo"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Costo total"),o("th",{class:"px-3 py-2 min-w-[60px] whitespace-nowrap dark:text-gray-100"},"Factor"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Valor unitario"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Subtotal"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Alerta mano de obra"),o("th",{class:"px-3 py-2 whitespace-nowrap rounded-r-2xl dark:text-gray-100"},"Acciones")])],-1),ke={class:"px-3 py-2 whitespace-nowrap dark:text-white"},qe={class:"p-2 whitespace-nowrap mx-auto text-center max-w-[50px] dark:text-white"},ve={class:"p-2 whitespace-nowrap xs:min-w-[100px] md:min-w-[500px] max-w-[1450px]"},Ie={class:"mx-auto px-0 py-2 whitespace-nowrap text-center"},Ee=["onUpdate:modelValue"],Ce={key:0,class:"px-3 py-2 whitespace-nowrap mx-auto text-center dark:text-gray-100"},Ve={key:1,class:"px-3 py-2 whitespace-nowrap mx-auto text-center dark:text-gray-100"},Ue=["onUpdate:modelValue"],De={class:"hidden print:block text-sm"},Ne=["id"],Ae={class:"px-3 py-2 whitespace-nowrap mx-auto text-center"},Be={key:0,class:"max-w-[150px] border-gray-50/75 text-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block w-full border-[0.5px] border-indigo-200 focus:border-indigo-700"},Me=o("br",null,null,-1),Oe=o("br",null,null,-1),$e={class:"p-2 whitespace-nowrap align-middle dark:text-gray-100"},ze={class:"inline-flex items-center justify-center w-full h-full"},Fe=["value","onInput"],Te=o("span",{class:"mx-2 w-1/6"}," %",-1),je={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ze={key:0},Pe={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Se={key:0},Re={class:"px-3 py-2 whitespace-nowrap mx-auto text-center dark:text-gray-100"},He=["onUpdate:modelValue"],Le={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Xe={key:0},We={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ge={key:0},Je={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ke={key:0},Qe={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ye=["onClick"],et={class:"text-gray-900 text-lg"},tt=o("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1),ot=o("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1),at=o("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1),st={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},rt={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},it={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},kt={__name:"ContinueItem",props:{item:{type:Object,required:!0},indexItem:{type:Number,required:!0},equipos:{type:Array,required:!0},mostrarDetalles:!0,plantilla:Number,CallOnce_Plantilla:!0,factores:{type:Array,default:()=>({})},factorSeleccionado:Number},emits:["updatiItems","checkzero"],setup(v,{emit:w}){const l=v,{_:nt,debounce:S,pickBy:lt}=ie,R=S(async a=>{if(!(!a||a.length<2))try{const t=await fetch(route("api.select.equipos")+"?q="+encodeURIComponent(a),{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});e.equiposOptions=await t.json()}catch(t){alert("Error al buscar equipos:",t)}},300),H=async a=>{if(!a)return null;try{const t=await fetch(route("api.select.equipos")+"?q="+encodeURIComponent(a));t.ok||alert("Error de red: "+t.statusText);const r=await t.json();return r.length>0?r[1]:null}catch(t){return console.error("Error buscando equipo, error:  ",t),null}},e=te({daitem:Object,equipos:l.equipos,equiposOptions:[],searchEquipo:"",subtotal:0,valorItemUnitario:0,cantidadItem:0,valorItemtotal:0,EquipsOnZero:!1,showFactorModal:!1});oe(async()=>{e.daitem=l.item,e.equipos=l.item.equipos||[],e.cantidadItem=l.item.cantidad,await f(),await L()});const L=async()=>{await Promise.all(e.equipos.map(async(a,t)=>{if(a.equipo_selec&&a.equipo_selec.value){const r=await H(a.equipo_selec.value);r&&(a.equipo_selec.title=r.title,a.equipo_selec.value=r.value)}})),await f()};function X(){let a=l.factorSeleccionado;if(!a||!Number.isInteger(l.factorSeleccionado))return;a=a-1;let r=e.equipos[e.equipos.length-1];r.factor_final=l.factores[a].value??1}const W=(a,t)=>{f(),G(a)};function G(a){const t=e.equipos[a],r=t.equipo_selec.descuento_basico??0,g=t.equipo_selec.descuento_proyectos??0;e.equipos[a].descuento_final=r>=g?r:g}function J(a){e.equipos.splice(a,1)}function K(a){for(a<0&&(a=0);e.equipos.length<a;)e.equipos.push({nombre_item:e.daitem.nombre??"",equipo_selec:null,cantidad:1,subtotalequip:0});for(;e.equipos.length>a;)e.equipos.pop();X()}const q=z(()=>!e.valorItemUnitario||!e.cantidadItem?0:e.valorItemUnitario*e.cantidadItem),Q=z(()=>q.value?pe(q.value):"");function I(a){e.valorItemUnitario=0,e.equipos.forEach(t=>{if(t.equipo_selec&&t.cantidad>0){(t.descuento_final>1||t.descuento_final<0)&&alert("Descuento invalido. Codigo: "+t.equipo_selec.value);const r=t.descuento_final?1-t.descuento_final:1;t.costounitario=r*t.equipo_selec.precio_de_lista,t.costototal=t.costounitario*t.cantidad,t.valorunitario=t.costounitario*t.factor_final,t.subtotalequip=t.cantidad*t.valorunitario}else t.subtotalequip=0,t.costounit=0;e.valorItemUnitario+=t.subtotalequip}),w("updatiItems",{equipos:e.equipos,valorItemUnitario:e.valorItemUnitario,TotalItem:q,indexItem:l.indexItem,cantidadItem:a,valor_total_item:e.valorItemUnitario*a,daitem:e.daitem})}const Y=a=>{e.EquipsOnZero=!1,a.forEach(t=>{var r;t.equipo_selec&&isNaN(Number((r=t.equipo_selec)==null?void 0:r.precio_de_lista))&&(e.EquipsOnZero=!0,w("checkzero",{index:l.indexItem,isZero:!0}))}),e.EquipsOnZero||w("checkzero",{index:l.indexItem,isZero:!1})};F(()=>e.equipos,(a,t)=>{a&&t&&(f(),I(e.cantidadItem),Y(a))},{deep:!0}),F(()=>e.cantidadItem,a=>{I(a)},{deep:!0});function E(a){return Math.trunc(a*100)/100}function ee(a){if(typeof a!="number"||a<0){console.error("El factor debe ser un número positivo.");return}e.equipos.forEach(t=>{t.factor_final=a})}return(a,t)=>{const r=ae("Button"),g=se("tooltip");return i(),d(j,null,[l.mostrarDetalles?(i(),d("div",he,[o("div",{id:"itemN"+l.indexItem,class:"absolute flex items-center justify-center text-white z-[1] rounded-xl inset-0.5 bg-gray-800 py-1"},[o("p",ye,"Item "+p(l.indexItem+1),1),h(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>e.daitem.nombre=n),class:"max-w-[880px] min-w-[480px] text-center border-0 py-0 dark:bg-gray-900 bg-gray-800 dark:text-gray-300 rounded-md mt-1 block w-full text-xl"},null,512),[[b,e.daitem.nombre]]),o("button",{onClick:t[1]||(t[1]=T(n=>w("deleteItem",l.indexItem),["prevent"])),class:"ml-4 bg-gray-900 hover:bg-red-900 text-white font-bold py-2 px-4 rounded"}," ¡Eliminar item! ")],8,xe),we])):u("",!0),o("div",ge,[e.EquipsOnZero?(i(),k(P,{key:0,message:"Hay equipos sin precio"})):u("",!0),o("table",fe,[be,(i(!0),d(j,null,re(e.equipos,(n,s)=>{var C,V,U,D,N,A,B,M,O,$;return i(),d("tbody",{key:s,class:"divide-y divide-gray-200 w-full"},[o("tr",{class:ne(["*:text-gray-900 *:first:font-medium dark:text-gray-100",{"bg-gray-200 dark:bg-gray-700":s%2!==0}])},[o("td",ke,p(s+1)+"°",1),o("td",qe,p(((C=n==null?void 0:n.equipo_selec)==null?void 0:C.value)??""),1),o("td",ve,[x(m(de),{modelValue:e.equipos[s].equipo_selec,"onUpdate:modelValue":[c=>e.equipos[s].equipo_selec=c,c=>W(s)],options:e.equiposOptions,label:"title",filterable:!1,"append-to-body":"",placeholder:"Buscar equipo...",class:"mt-1 block xs:min-w-[150px] md:min-w-[400px] w-full fixed",onSearch:t[2]||(t[2]=c=>{e.searchEquipo=c,m(R)(c)})},null,8,["modelValue","onUpdate:modelValue","options"])]),o("td",Ie,[h(o("input",{type:"number",min:"0","onUpdate:modelValue":c=>e.equipos[s].cantidad=c,class:"dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block pl-3 max-w-[110px] mx-auto border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,8,Ee),[[b,e.equipos[s].cantidad,void 0,{number:!0}]])]),((U=(V=e.equipos[s])==null?void 0:V.equipo_selec)==null?void 0:U.precio_de_lista2)!==0?(i(),d("td",Ce,[y(p(n!=null&&n.equipo_selec?m(_)(n==null?void 0:n.equipo_selec.precio_de_lista,0,1):"Sin valor")+" ",1),e.equipos[s]?h((i(),k(r,{key:0,type:"button",onClick:c=>e.equipos[s].equipo_selec.precio_de_lista2=0,class:"items-center py-2 bg-indigo-800 text-center border rounded-lg border-indigo-900 text-white hover:bg-indigo-500 cursor-pointer h-8 w-8 ml-2"},{default:Z(()=>[x(m(_e),{class:"w-4 mx-auto"})]),_:2},1032,["onClick"])),[[g,"Editar"]]):u("",!0)])):(D=e.equipos[s])!=null&&D.equipo_selec?(i(),d("td",Ve,[h(o("input",{type:"number","onUpdate:modelValue":c=>e.equipos[s].equipo_selec.precio_de_lista=c,class:"no-print max-w-[120px] border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block w-full"},null,8,Ue),[[b,e.equipos[s].equipo_selec.precio_de_lista,void 0,{number:!0}]]),o("div",De,p((A=(N=e.equipos[s])==null?void 0:N.equipo_selec)==null?void 0:A.precio_de_lista),1),((M=(B=e.equipos[s])==null?void 0:B.equipo_selec)==null?void 0:M.precio_de_lista)==0?(i(),d("div",{key:0,id:"valor-nulo"+v.indexItem+"_"+s,class:"bg-red-600"}," Valor nulo! ",8,Ne)):u("",!0)])):u("",!0),o("td",Ae,[e.equipos[s].equipo_selec?(i(),d("p",Be,[y(" Basico: "+p(E(((O=e.equipos[s])==null?void 0:O.equipo_selec.descuento_basico)*100))+" %",1),Me,y(" Proyectos: "+p(E((($=e.equipos[s])==null?void 0:$.equipo_selec.descuento_proyectos)*100))+" %",1),Oe])):u("",!0)]),o("td",$e,[o("div",ze,[o("input",{type:"number",min:"0",max:"100",value:e.equipos[s].descuento_final*100,onInput:c=>e.equipos[s].descuento_final=Math.max(0,c.target.valueAsNumber/100||0),class:"border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md max-w-[80px] border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,40,Fe),y(),Te])]),o("td",je,[e.equipos[s].equipo_selec?(i(),d("p",Ze,p(m(_)(e.equipos[s].costounitario,0,1)),1)):u("",!0)]),o("td",Pe,[e.equipos[s].equipo_selec?(i(),d("p",Se,p(m(_)(e.equipos[s].costototal,0,1)),1)):u("",!0)]),o("td",Re,[h(o("input",{type:"number",step:"0.01","onUpdate:modelValue":c=>e.equipos[s].factor_final=c,min:"0",class:"min-w-[75px] max-w-32 border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,8,He),[[b,e.equipos[s].factor_final,void 0,{number:!0}]])]),o("td",Le,[e.equipos[s].equipo_selec?(i(),d("p",Xe,p(m(_)(e.equipos[s].valorunitario,0,1)),1)):u("",!0)]),o("td",We,[e.equipos[s].equipo_selec?(i(),d("p",Ge,p(m(_)(e.equipos[s].subtotalequip,0,1)),1)):u("",!0)]),o("td",Je,[e.equipos[s].equipo_selec?(i(),d("p",Ke,p(e.equipos[s].equipo_selec.alerta_mano_obra),1)):u("",!0)]),o("td",Qe,[o("button",{onClick:T(c=>J(s),["prevent"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}," Eliminar ",8,Ye)])],2)])}),128)),o("tr",et,[tt,ot,at,o("th",st,p(m(_)(e.valorItemUnitario,0,1)),1),o("th",rt,[x(le,{type:"number",class:"min-w-[40px] max-w-[80px] pl-5 border rounded-xl print:hidden",modelValue:e.cantidadItem,"onUpdate:modelValue":t[3]||(t[3]=n=>e.cantidadItem=n),modelModifiers:{number:!0},required:"",placeholder:a.lang().placeholder.cantidad},null,8,["modelValue","placeholder"])]),o("th",it,p(Q.value),1)])]),x(me,{onClick:t[4]||(t[4]=n=>e.showFactorModal=!0),class:"mt-4"},{default:Z(()=>[y("Actualizar Factores")]),_:1}),x(ue,{show:e.showFactorModal,onClose:t[5]||(t[5]=n=>e.showFactorModal=!1),onConfirm:ee},null,8,["show"]),e.EquipsOnZero?(i(),k(P,{key:1,message:"Hay equipos sin precio"})):u("",!0),l.mostrarDetalles?(i(),k(ce,{key:2,initialEquipos:e.equipos.length,onUpdatEquipos:K,class:"no-print mt-4 mb-10 mx-auto w-fit"},null,8,["initialEquipos"])):u("",!0)])],64)}}};export{kt as default};
