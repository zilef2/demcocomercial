import{k as L,T as F,j as H,l as P,p as E,f as n,a as l,w as V,o as c,b as d,t as g,u as o,g as p,F as z,m as G,d as T,n as q,e as I}from"./app-551012d8.js";import{_ as h}from"./InputError-23c0a787.js";import{_ as j}from"./InputLabel-8615b764.js";import{M as J}from"./Modal-e8455b5b.js";import{_ as W}from"./PrimaryButton-bd076b11.js";import{_ as K}from"./SecondaryButton-ec5b0153.js";import{_ as x}from"./TextInput-4b8270d6.js";import{C as _}from"./vue-select.es-e7a5a940.js";/* empty css                   *//* empty css             */import{T as Q,b as A,D as X}from"./global-6d1c7c87.js";const Y={class:"space-y-6 dark:text-white"},Z=["onSubmit"],ee={class:"text-lg font-medium text-gray-900 dark:text-white"},oe={class:"grid xs:grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},ae={key:0,id:"opcinesActividadO",class:"xl:col-span-2 col-span-1"},te=d("label",{class:"dark:text-white",name:""},[T(" Reportar en nombre de: "),d("small",null,"(Opcional) ")],-1),ie={id:"opcinesActividadO",class:"xs:col-span-1 xl:col-span-2"},le=d("label",{class:"dark:text-white"}," Tipo de reporte ",-1),se={class:"xs:col-span-1 xl:col-span-1"},re={class:"dark:text-white col-span-1"},de={id:"Scentrotrabajo",class:"xs:col-span-1 xl:col-span-1"},ne=d("label",{name:"centrotrabajo_id",class:"dark:text-white"}," Centro de trabajo ",-1),ce={key:1,id:"Sordentrabajo",class:"xl:col-span-1 xs:col-span-1"},ue=d("label",{class:"dark:text-white"}," Número de oferta ",-1),pe={key:2,class:"xl:col-span-1 xs:col-span-1"},me=d("label",{name:"ot_id",class:"dark:text-white"}," Número de OT ",-1),_e={key:3,class:"mt-6"},be={key:4,class:"w-full xl:col-span-2 xs:col-span-1 dark:text-white"},fe={key:5,class:"w-full col-span-1 dark:text-white"},ve={key:6,class:"col-span-1 dark:text-white"},ge={key:7,id:"actividad",class:"xl:col-span-2 col-span-1"},he=d("label",{name:"actividad_id",class:"dark:text-white"}," Actividad ",-1),je={key:8,id:"reproceso",class:"xl:col-span-2 col-span-1"},xe=d("label",{name:"reproceso_id",class:"dark:text-white"}," Reproceso",-1),ke={key:9,id:"disponibilidad",class:"xl:col-span-3 col-span-1"},ye=d("label",{name:"disponibilidad_id",class:"dark:text-white"}," Disponibilidad",-1),we={key:0,class:"mt-5 p-4 bg-yellow-100 border border-yellow-400 text-yellow-700 dark:text-red-400"},Ve=d("p",null,"Errores detectados:",-1),Te={class:"list-disc list-inside"},Oe={class:"mb-8 mt-[360px] flex justify-end"},Ce={key:0,class:"mx-12 px-8 text-lg font-medium text-red-600 bg-red-50 dark:text-red-400 dark:bg-gray-800"},Re={key:1,class:"mx-12 px-8 text-lg font-medium text-gray-800 dark:text-white dark:bg-gray-800"},Pe={__name:"Create",props:{show:Boolean,title:String,roles:Object,losSelect:Object,numberPermissions:Number,valuesGoogleCabeza:Object,valuesGoogleBody:Object,Trabajadores:Object,losOT:Object},emits:["close"],setup(D,{emit:y}){const u=D,i=L({params:{pregunta:""},actividad_id:u.losSelect.actividad,centrotrabajo_id:u.losSelect.centrotrabajo,disponibilidad_id:u.losSelect.disponibilidad,ordentrabajo_id:u.losSelect.ordentrabajo,reproceso_id:u.losSelect.reproceso,temp_disponibilidad_id:null,temp_reproceso_id:null,temp_actividad_id:null,valorInactivo:"NA",cabeza:u.valuesGoogleCabeza,nombresOT:Object.values(u.valuesGoogleBody),mensajeFalta:"",BanderaTipo:!0,mensajeTiemposAuto:"",limiteMinimo:"",ordentrabajo_ids:[],ot2:[],tenemosCentro:!1,soloParaOfertas:!1}),e=F({...Object.fromEntries(["tipoReporte","fecha","hora_inicial","hora_final","actividad_id","centrotrabajo_id","disponibilidad_id","operario_id","ordentrabajo_id","reproceso_id","ordentrabajo_ids","otitem","user_id","numero_oferta","OTItem","TiempoEstimado","ot_id"].map(t=>[t,""]))}),O=()=>{let t=new Date;t.setHours(t.getHours()-1);let a=r=>r<10?`0${r}`:r;return`${a(t.getHours())}:${a(t.getMinutes())}`},N=t=>(t.preventDefault(),!1);H(()=>{i.limiteMinimo=O(),setInterval(()=>{i.limiteMinimo=O()},6e4),document.body.addEventListener("contextmenu",N),i.ordentrabajo_ids=i.nombresOT.map(t=>{var a;return{title:(a=t.numero_oferta)==null?void 0:a.replace(/_/g," "),value:t.id}}),i.ot2=i.nombresOT.map(t=>{var a;return{title:(a=t.ot)==null?void 0:a.replace(/_/g," "),value:t.id}})});let w=t=>{let a="";try{t.forEach(r=>{if(typeof e[r]>"u"||e[r]===null||e[r].value===null||e[r].length===0)throw a=r,new Error("BreakException")})}catch{}return a},B=()=>{let t=e.tipoReporte.value,a=!0;const r=". Campo obligatorio";let b=new Date().getHours(),f=X(b+":00",e.hora_inicial);if(e.actividad_id==null||e.actividad_id.value===0)return"Hay campos vacios";if(f>0)return"Ha pasado mucho tiempo!";t===0&&(a=w(["centrotrabajo_id","actividad_id"])),t===1&&(a=w(["centrotrabajo_id","actividad_id","reproceso_id"])),t===2&&(a=w(["centrotrabajo_id","disponibilidad_id"]));let v={ordentrabajo_ids:"Orden trabajo",actividad_id:"Actividad",reproceso_id:"Reproceso",centrotrabajo_id:"Centro de trabajo",disponibilidad_id:"Disponibilidad"};return a!==""?v[a]+r:a};P(()=>{var t,a,r,b,f,v;if(u.show){if(i.BanderaTipo&&(e.tipoReporte={title:"Actividad",value:0},i.BanderaTipo=!1),e.errors={},e.fecha===null||e.fecha===""){let m=new Date;e.fecha=Q(m).substring(0,10),e.hora_inicial=A()}if(e.ordentrabajo_ids&&e.ordentrabajo_ids.value||e.ot_id&&e.ot_id.id){console.table(i.nombresOT.slice(0,10));let m;i.tenemosCentro=!1,e.ordentrabajo_ids&&((a=(t=e.centrotrabajo_id)==null?void 0:t.title)==null?void 0:a.toLowerCase())==="ofertas"?(i.tenemosCentro=!0,m=i.nombresOT.find(k=>k.id===e.ordentrabajo_ids.value)):e.ot_id&&((b=(r=e.centrotrabajo_id)==null?void 0:r.title)==null||b.toLowerCase()),i.tenemosCentro&&(e.avance=m.avance,e.cliente=m.cliente,e.TiempoEstimado=m.tiempo_estimado)}i.soloParaOfertas=(e.ordentrabajo_ids||e.ot_id)&&e.tipoReporte.value!==2&&((v=(f=e.centrotrabajo_id)==null?void 0:f.title)==null?void 0:v.toLowerCase())==="ofertas"}else i.BanderaTipo=!0}),E(()=>e.tipoReporte,()=>{e.actividad_id=null,e.centrotrabajo_id=null,e.disponibilidad_id=null,e.operario_id=null,e.ordentrabajo_id=null,e.reproceso_id=null,e.ordentrabajo_ids=null,e.numero_oferta=null,e.TiempoEstimado=null}),E(()=>e.centrotrabajo_id,t=>{if(t&&typeof t.value<"u"){let a="centrotrabajo"+t.title;i.actividad_id=u.losSelect[a],e.ordentrabajo_ids=null,e.ot_id=null,e.avance=null,e.cliente=null,e.TiempoEstimado=null,i.tenemosCentro=!1,u.numberPermissions>9&&setTimeout(()=>{e.actividad_id=i.actividad_id[1]},120)}e.actividad_id={title:"Seleccione actividad",value:null}});const C=()=>{e.ordentrabajo_id=e.ordentrabajo_ids,i.mensajeFalta=B(),e.hora_inicial=A(),i.mensajeFalta===""&&setTimeout(M(),500)},M=()=>(e.post(route("reporte.store"),{preserveScroll:!0,onSuccess:()=>{y("close"),e.reset()},onError:()=>alert(JSON.stringify(e.errors,null,4)),onFinish:()=>null}),null),U=[{title:"Actividad",value:0},{title:"Reproceso",value:1},{title:"Disponibilidad (paro)",value:2}];return(t,a)=>(c(),n("section",Y,[l(J,{show:u.show,onClose:a[12]||(a[12]=r=>y("close")),maxWidth:"4xl"},{default:V(()=>{var r,b,f,v,m,k,R,S;return[d("form",{class:"px-6 my-8",onSubmit:I(C,["prevent"])},[d("h2",ee,g(t.lang().label.add)+" "+g(u.title),1),d("div",oe,[u.numberPermissions>1?(c(),n("div",ae,[te,l(o(_),{options:u.Trabajadores,label:"title",class:"dark:bg-gray-400",modelValue:o(e).user_id,"onUpdate:modelValue":a[0]||(a[0]=s=>o(e).user_id=s)},null,8,["options","modelValue"])])):p("",!0),d("div",ie,[le,l(o(_),{options:U,label:"title",class:"dark:bg-gray-400",modelValue:o(e).tipoReporte,"onUpdate:modelValue":a[1]||(a[1]=s=>o(e).tipoReporte=s)},null,8,["modelValue"])]),d("div",se,[l(j,{for:"fecha",value:t.lang().label.fecha,class:"dark:text-white"},null,8,["value"]),l(x,{id:"fecha",type:"date",class:"mt-1 block w-full bg-gray-200 dark:text-white",modelValue:o(e).fecha,"onUpdate:modelValue":a[2]||(a[2]=s=>o(e).fecha=s),disabled:"",placeholder:"fecha",error:o(e).errors.fecha},null,8,["modelValue","error"]),l(h,{class:"mt-2",message:o(e).errors.fecha},null,8,["message"])]),d("div",re,[l(j,{for:"hora_inicial",value:t.lang().label["hora inicial"]},null,8,["value"]),l(x,{id:"hora_inicial",type:"time",class:"mt-1 block w-full",disabled:"",modelValue:o(e).hora_inicial,"onUpdate:modelValue":a[3]||(a[3]=s=>o(e).hora_inicial=s),placeholder:"hora_inicial",error:o(e).errors.hora_inicial,step:"60"},null,8,["modelValue","error"]),l(h,{class:"mt-2",message:o(e).errors.hora_inicial},null,8,["message"])]),d("div",de,[ne,l(o(_),{options:i.centrotrabajo_id,label:"title",class:"dark:bg-gray-400",modelValue:o(e).centrotrabajo_id,"onUpdate:modelValue":a[4]||(a[4]=s=>o(e).centrotrabajo_id=s)},null,8,["options","modelValue"]),l(h,{class:"mt-2",message:o(e).errors.centrotrabajo_id},null,8,["message"])]),o(e).tipoReporte.value!==2&&((b=(r=o(e).centrotrabajo_id)==null?void 0:r.title)==null?void 0:b.toLowerCase())==="ofertas"?(c(),n("div",ce,[ue,l(o(_),{options:i.ordentrabajo_ids,label:"title",class:"dark:bg-gray-400",modelValue:o(e).ordentrabajo_ids,"onUpdate:modelValue":a[5]||(a[5]=s=>o(e).ordentrabajo_ids=s)},null,8,["options","modelValue"])])):o(e).tipoReporte.value!==2&&((v=(f=o(e).centrotrabajo_id)==null?void 0:f.title)==null?void 0:v.toLowerCase())==="proyectos"?(c(),n("div",pe,[me,l(o(_),{options:u.losOT,label:"nombre",class:"dark:bg-gray-400",modelValue:o(e).ot_id,"onUpdate:modelValue":a[6]||(a[6]=s=>o(e).ot_id=s)},null,8,["options","modelValue"]),l(h,{class:"mt-2",message:o(e).errors.ordentrabajo_id},null,8,["message"])])):o(e).tipoReporte.value!==2&&((k=(m=o(e).centrotrabajo_id)==null?void 0:m.title)==null?void 0:k.toLowerCase())!=="ofertas"&&((S=(R=o(e).centrotrabajo_id)==null?void 0:R.title)==null?void 0:S.toLowerCase())!=="proyectos"?(c(),n("div",_e," Seleccione centro de trabajo ")):p("",!0),i.soloParaOfertas?(c(),n("div",be,[l(j,{for:t.index,value:"Cliente",class:""},null,8,["for"]),l(x,{id:t.index,type:"text",disabled:"",class:"mt-1 block w-full bg-gray-200",value:o(e).cliente},null,8,["id","value"])])):p("",!0),i.soloParaOfertas?(c(),n("div",fe,[l(j,{for:t.index,value:"% avance"},null,8,["for"]),l(x,{id:t.index,type:"text",disabled:"",class:"mt-1 block w-full bg-gray-200",value:o(e).avance},null,8,["id","value"])])):p("",!0),i.soloParaOfertas?(c(),n("div",ve,[l(j,{for:t.index,value:"Tiempo estimado"},null,8,["for"]),l(x,{id:t.index,type:"text",disabled:"",class:"mt-1 block w-full bg-gray-200 dark:bg-gray-400 dark:text-white",modelValue:o(e).TiempoEstimado,"onUpdate:modelValue":a[7]||(a[7]=s=>o(e).TiempoEstimado=s)},null,8,["id","modelValue"])])):p("",!0),o(e).tipoReporte.value===0||o(e).tipoReporte.value===1?(c(),n("div",ge,[he,l(o(_),{options:i.actividad_id,label:"title",required:"",modelValue:o(e).actividad_id,"onUpdate:modelValue":a[8]||(a[8]=s=>o(e).actividad_id=s),class:"dark:bg-gray-400"},null,8,["options","modelValue"]),l(h,{class:"mt-2",message:o(e).errors.actividad_id},null,8,["message"])])):p("",!0),o(e).tipoReporte.value===1?(c(),n("div",je,[xe,l(o(_),{options:i.reproceso_id,label:"title",required:"",modelValue:o(e).reproceso_id,"onUpdate:modelValue":a[9]||(a[9]=s=>o(e).reproceso_id=s),class:"dark:bg-gray-400"},null,8,["options","modelValue"]),l(h,{class:"mt-2",message:o(e).errors.reproceso_id},null,8,["message"])])):p("",!0),o(e).tipoReporte.value===2?(c(),n("div",ke,[ye,l(o(_),{options:i.disponibilidad_id,label:"title",required:"",modelValue:o(e).disponibilidad_id,"onUpdate:modelValue":a[10]||(a[10]=s=>o(e).disponibilidad_id=s),class:"dark:bg-gray-400"},null,8,["options","modelValue"]),l(h,{class:"mt-2",message:o(e).errors.disponibilidad_id},null,8,["message"])])):p("",!0)]),Object.keys(o(e).errors).length>0?(c(),n("div",we,[Ve,d("ul",Te,[(c(!0),n(z,null,G(o(e).errors,(s,$)=>(c(),n("li",{key:$},g(s),1))),128))])])):p("",!0),d("div",Oe,[i.mensajeFalta!==""?(c(),n("h2",Ce,g(i.mensajeFalta),1)):p("",!0),i.mensajeTiemposAuto!==""?(c(),n("h2",Re,g(i.mensajeTiemposAuto),1)):p("",!0),l(K,{disabled:o(e).processing,onClick:a[11]||(a[11]=s=>y("close"))},{default:V(()=>[T(g(t.lang().button.close),1)]),_:1},8,["disabled"]),l(W,{class:q(["ml-3",{"opacity-25":o(e).processing}]),disabled:o(e).processing,onClick:C},{default:V(()=>[T(g(o(e).processing?t.lang().button.add+"...":t.lang().button.add),1)]),_:1},8,["class","disabled"])])],40,Z)]}),_:1},8,["show"])]))}};export{Pe as default};
