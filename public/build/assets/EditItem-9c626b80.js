import{k as ie,j as ne,z as x,h as T,p as K,A as le,q as ce,f as u,b as a,t as p,e as b,a1 as P,g as m,c as g,F as j,m as pe,u as _,a as y,w as L,o as i,n as de,v as q,B as H,d as f,s as ue}from"./app-551012d8.js";import{_ as me}from"./TextInput-4b8270d6.js";/* empty css             */import _e from"./Add_Sub_equipos-f939d446.js";import{n as w,a as R}from"./global-6d1c7c87.js";import{f as I,a as G,o as we,b as he,s as xe}from"./focusStore-50e14bee.js";/* empty css                   */import{C as ye}from"./vue-select.es-e7a5a940.js";import{_ as J}from"./InputError-23c0a787.js";import{_ as fe}from"./FactorModal-3003c42d.js";import{_ as be}from"./PrimaryButton-bd076b11.js";import{r as ge}from"./PencilIcon-7035d21d.js";import"./Modal-e8455b5b.js";import"./SecondaryButton-ec5b0153.js";const ve={key:0,class:"text-center mx-auto mt-6 mb-2 relative drop-shadow-xl min-w-[680px] h-12 overflow-hidden rounded-xl bg-gray-800"},ke=["id"],qe={class:"text-center text-lg mx-2 w-32"},Ie=["value"],Ee=["onClick","onKeydown"],Ce=a("div",{class:"absolute w-56 h-48 bg-white blur-[50px] -left-1/2 -top-1/2"},null,-1),Fe={class:"overflow-x-auto divide-y-1 divide-gray-200 w-full dark:text-gray-100"},Ve=a("thead",{class:"ltr:text-left rtl:text-right w-full"},[a("tr",{class:"*:font-medium dark:text-gray-900 bg-gray-900 text-white shadow-md rounded-xl"},[a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap rounded-l-2xl"},"#"),a("th",{class:"dark:text-white px-3 py-2 mx-2 min-w-[10px]"},"Código"),a("th",{class:"dark:text-white px-3 py-2 mx-2 whitespace-nowrap min-w-[150px] max-w-[700px]"},"Descripción "),a("th",{class:"dark:text-white -px-1 py-2 whitespace-nowrap max-w-[80px]"},"Cantidad"),a("th",{class:"dark:text-white px-3 py-2 min-w-[180px] max-w-[400px] whitespace-nowrap"},"Precio de lista"),a("th",{class:"dark:text-white lg:table-cell px-3 py-2 whitespace-nowrap"},"Descuentos"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap"},"Descuento final %"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap"},"Costo"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap"},"Costo total"),a("th",{class:"dark:text-white px-3 py-2 max-w-[40px] whitespace-nowrap"},"Factor"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap"},"Valor unitario"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap"},"Subtotal"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap"},"Alerta mano de obra"),a("th",{class:"dark:text-white px-3 py-2 whitespace-nowrap rounded-r-2xl"},"Acciones")])],-1),Ue={class:"px-3 py-2 whitespace-nowrap dark:text-white"},$e={class:"p-2 whitespace-nowrap mx-auto text-center max-w-[50px] dark:text-white"},ze={class:"p-2 whitespace-nowrap xs:min-w-[100px] md:min-w-[500px] max-w-[1450px]"},De={class:"mx-auto px-0 py-2 whitespace-nowrap text-center"},Be=["onUpdate:modelValue"],Ne={key:0,class:"px-1 py-2 whitespace-nowrap mx-auto text-center"},Oe={class:"w-full dark:text-white"},Ae={key:1,class:"py-2 whitespace-nowrap mx-auto text-center"},Me=["value","onInput"],Ze={class:"hidden print:block text-sm"},Se=["id"],Te={class:"text-xs md:text-md lg:table-cell px-3 py-2 whitespace-nowrap mx-auto text-center"},Ke={key:0,class:"max-w-[150px] border-gray-50/75 text-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block w-full border-[0.5px] border-indigo-200 focus:border-indigo-700"},Pe=a("br",null,null,-1),je=a("br",null,null,-1),Le={class:"p-2 whitespace-nowrap align-middle dark:text-gray-100"},He={class:"inline-flex items-center justify-center w-full h-full"},Re=["value","onInput"],Ge=a("span",{class:"mx-2 w-1/6"}," %",-1),Je={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Qe={key:0},We={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Xe={key:0},Ye={class:"px-3 py-2 whitespace-nowrap mx-auto text-center"},et=["onUpdate:modelValue"],tt={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},ot={key:0},at={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},st={key:0},rt={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},it={key:0},nt={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},lt=["onClick","onKeydown"],ct={class:"text-gray-900 text-lg"},pt=a("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1),dt=a("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1),ut=a("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1),mt={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},_t={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},wt={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},zt={__name:"EditItem",props:{item:{type:Object,required:!0},indexItem:{type:Number,required:!0},equipos:{type:Array,required:!0},mostrarDetalles:!0,plantilla:Number,factores:{type:Array,default:()=>({})},factorSeleccionado:Number,onmountedisOk:Boolean},emits:["upd_itemname","updateItem","checkzero","deleteItem"],setup(v,{emit:h}){const r=v,{_:ht,debounce:Q,pickBy:xt}=ue,W=async o=>{if(!o)return null;try{const t=await fetch(route("api.select.equips2")+"?q="+encodeURIComponent(o));t.ok||alert("Error de red: "+t.statusText);const c=await t.json();return c.length>0?c[1]:null}catch(t){return console.error("Error buscando equipo, error:  ",t),null}},e=ie({equipos:r.item.equipos,equiposOptions:[],searchEquipo:"",subtotal:0,valorItemUnitario:0,cantidadItem:0,valorItemtotal:0,EquipsOnZero:!1,showFactorModal:!1});function X(o){!o||o.length<2||Q(()=>he(o,e),300)()}ne(async()=>{r.onmountedisOk&&(await x(),e.equipos=r.equipos||[],e.cantidadItem=r.item.cantidad,e.valorItemUnitario=r.item.valor_unitario_item,e.valorItemtotal=r.item.valor_total_item,await x(),await Y())});const Y=async()=>{r.equipos&&await Promise.all(r.equipos.map(async(o,t)=>{if(o.codigo){const c=parseInt(o.codigo);if(c){if(e.equipos[t].cantidad=o.pivot.cantidad_equipos,e.equipos[t].factor_final=parseFloat(o.pivot.factor),e.equipos[t].costounitario=parseFloat(o.pivot.costo_unitario),e.equipos[t].costototal=parseFloat(o.pivot.costo_total),e.equipos[t].subtotalequip=parseFloat(o.pivot.subtotalequip),e.equipos[t].valorunitario=parseFloat(o.pivot.valorunitarioequip),e.equipos[t].descuento_final=parseFloat(o.pivot.descuento_final),o.pivot.precio_de_lista)e.equipos[t].equipo_selec={value:c,title:o.pivot.descripcion,precio_de_lista:o.pivot.precio_de_lista,descuento_basico:parseFloat(o.pivot.descuento_basico),descuento_proyectos:parseFloat(o.pivot.descuento_proyectos),descuento_final:parseFloat(o.pivot.descuento_final)};else{const l=await W(c);l&&(e.equipos[t].equipo_selec={value:c,title:l.title,precio_de_lista:o.pivot.precio_de_lista??l.precio_de_lista,alerta_mano_obra:o.pivot.alerta_mano_obra??l.alerta_mano_obra,descuento_basico:parseFloat(o.pivot.descuento_basico)??l.descuento_basico,descuento_proyectos:parseFloat(o.pivot.descuento_proyectos)??l.descuento_proyectos,descripcion:o.pivot.descripcion??l.descripcion,precio_ultima_compra:o.pivot.precio_ultima_compra??l.precio_ultima_compra,precio_con_descuento:o.pivot.precio_con_descuento??l.precio_con_descuento,precio_con_descuento_proyecto:o.pivot.precio_con_descuento_proyecto??l.precio_con_descuento_proyecto,nombrefactor:o.pivot.nombrefactor??l.nombrefactor,equipo_id:o.pivot.equipo_id??l.equipo_id,fecha_actualizacion:o.pivot.fecha_actualizacion??l.fecha_actualizacion})}e.cantidadItem=r.item.cantidadItem}}})),await x()};function ee(){confirm("¿Está seguro de eliminar este item?")&&(h("checkzero",{index:r.indexItem,isZero:!1}),h("deleteItem",r.indexItem))}const te=(o,t)=>{x(),xe(o,e)};function oe(o){e.equipos.splice(o,1)}const k=T(()=>!e.valorItemUnitario||!e.cantidadItem?0:e.valorItemUnitario*e.cantidadItem),ae=T(()=>k.value?R(k.value):"");function E(o){e.valorItemUnitario=0,e.equipos.forEach(t=>{if(t.equipo_selec&&t.cantidad>0){(t.descuento_final>1||t.descuento_final<0)&&alert("Descuento invalido. Codigo: "+t.equipo_selec.value);const c=t.descuento_final?1-t.descuento_final:1;t.costounitario=c*t.equipo_selec.precio_de_lista,t.costototal=t.costounitario*t.cantidad,t.valorunitario=t.costounitario*t.factor_final,t.subtotalequip=t.cantidad*t.valorunitario}else t.subtotalequip=0,t.costounit=0;e.valorItemUnitario+=t.subtotalequip}),h("updateItem",r.indexItem,{...r.item,cantidad:o,equipos:e.equipos,valor_total:k.value})}const se=o=>{e.EquipsOnZero=!1,o.forEach(t=>{var c;t.equipo_selec&&isNaN(Number((c=t.equipo_selec)==null?void 0:c.precio_de_lista))&&(e.EquipsOnZero=!0,h("checkzero",{index:r.indexItem,isZero:!0}))}),e.EquipsOnZero||h("checkzero",{index:r.indexItem,isZero:!1})};K(()=>e.equipos,(o,t)=>{o&&t&&(x(),E(e.cantidadItem),se(o))},{deep:!0}),K(()=>e.cantidadItem,o=>{E(o)},{deep:!0});function C(o){return Math.trunc(o*100)/100}function re(o){if(typeof o!="number"||o<0){alert("El factor debe ser un número positivo.");return}e.equipos.forEach(t=>{t.factor_final=o})}return window.addEventListener("keydown",o=>{o.ctrlKey&&o.key.toLowerCase()==="p"&&(o.preventDefault(),I.focusedItemIndex===r.indexItem&&G(e.equipos.length+1,e,r,r.factorSeleccionado))}),(o,t)=>{var F;const c=le("Button"),l=ce("tooltip");return i(),u(j,null,[r.mostrarDetalles?(i(),u("div",ve,[a("div",{id:"itemN"+r.indexItem,class:"absolute flex items-center justify-center text-white z-[1] rounded-xl inset-0.5 bg-gray-800 py-1"},[a("p",qe,"Item "+p(v.indexItem+1),1),a("input",{type:"text",value:r.item.nombre,onInput:t[0]||(t[0]=d=>o.$emit("upd_itemname",r.indexItem,d.target.value)),class:"max-w-[880px] min-w-[480px] text-center border-0 py-0 dark:bg-gray-900 bg-gray-800 dark:text-gray-300 rounded-md mt-1 block w-full text-xl"},null,40,Ie),a("button",{onClick:b(ee,["prevent"]),type:"button",onKeydown:P(b(d=>!1,["prevent"]),["enter"]),class:"ml-4 bg-gray-900 hover:bg-red-900 text-white font-bold py-2 px-4 rounded"}," ¡Eliminar item! ",40,Ee)],8,ke),Ce])):m("",!0),a("div",{class:"p-4 mb-6 grid-cols-2 gap-4 overflow-x-auto xs:min-w-[700px] md:min-w-[1500px] 2xl:min-w-[1800px] bg-gray-50 dark:bg-gray-900 border-x-[2px] border-gray-300 dark:border-indigo-700 rounded-xl hover:shadow-indigo-300/50 dark:hover:shadow-indigo-700/50 transition-all duration-500 ease-in-out",onFocusin:t[6]||(t[6]=d=>_(I).setFocusedItem(r.indexItem)),onFocusout:t[7]||(t[7]=d=>_(I).clearFocusedItem())},[e.EquipsOnZero?(i(),g(J,{key:0,message:"Hay equipos sin precio"})):m("",!0),a("table",Fe,[Ve,(i(!0),u(j,null,pe(e.equipos,(d,s)=>{var V,U,$,z,D,B,N,O,A,M,Z,S;return i(),u("tbody",{key:s,class:"divide-y divide-gray-200 w-full"},[a("tr",{class:de(["*:text-gray-900 *:first:font-medium dark:text-gray-100",{"bg-gray-200 dark:bg-gray-700":s%2!==0}])},[a("td",Ue,p(s+1)+"°",1),a("td",$e,p(((V=d==null?void 0:d.equipo_selec)==null?void 0:V.value)??""),1),a("td",ze,[y(_(ye),{modelValue:e.equipos[s].equipo_selec,"onUpdate:modelValue":[n=>e.equipos[s].equipo_selec=n,n=>te(s)],options:e.equiposOptions,label:"title",filterable:!1,"append-to-body":"",placeholder:"Buscar equipo...",class:"zilefvs mt-1 block xs:min-w-[150px] md:min-w-[400px] w-full fixed",onSearch:t[1]||(t[1]=n=>{e.searchEquipo=n,X(n)})},null,8,["modelValue","onUpdate:modelValue","options"])]),a("td",De,[q(a("input",{type:"number",min:"0","onUpdate:modelValue":n=>e.equipos[s].cantidad=n,class:"dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block pl-3 max-w-[80px] mx-auto border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,8,Be),[[H,e.equipos[s].cantidad,void 0,{number:!0}]])]),(($=(U=e.equipos[s])==null?void 0:U.equipo_selec)==null?void 0:$.precio_de_lista2)!==0?(i(),u("td",Ne,[a("p",Oe,[f(p((z=e.equipos[s])!=null&&z.equipo_selec?_(w)((D=e.equipos[s])==null?void 0:D.equipo_selec.precio_de_lista,0,1):"Sin valor")+" ",1),e.equipos[s]?q((i(),g(c,{key:0,type:"button",onClick:n=>e.equipos[s].equipo_selec.precio_de_lista2=0,class:"items-center py-2 bg-green-700 text-center border rounded-lg border-green-800 text-white hover:bg-green-500 cursor-pointer h-8 w-8 ml-2"},{default:L(()=>[y(_(ge),{class:"w-4 mx-auto"})]),_:2},1032,["onClick"])),[[l,"Editar"]]):m("",!0)])])):(B=e.equipos[s])!=null&&B.equipo_selec?(i(),u("td",Ae,[a("input",{type:"text",value:_(R)(e.equipos[s].equipo_selec.precio_de_lista),onInput:n=>_(we)(n,s,e),class:"max-w-[140px] border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block w-full"},null,40,Me),a("div",Ze,p((O=(N=e.equipos[s])==null?void 0:N.equipo_selec)==null?void 0:O.precio_de_lista),1),((M=(A=e.equipos[s])==null?void 0:A.equipo_selec)==null?void 0:M.precio_de_lista)==0?(i(),u("div",{key:0,id:"valor-nulo"+v.indexItem+"_"+s,class:"bg-red-600 mx-1 mt-2 max-w-[150px] rounded-lg"}," Valor nulo! ",8,Se)):m("",!0)])):m("",!0),a("td",Te,[e.equipos[s].equipo_selec?(i(),u("p",Ke,[f(" Basico: "+p(C(((Z=e.equipos[s])==null?void 0:Z.equipo_selec.descuento_basico)*100))+" %",1),Pe,f(" Proyectos: "+p(C(((S=e.equipos[s])==null?void 0:S.equipo_selec.descuento_proyectos)*100))+" %",1),je])):m("",!0)]),a("td",Le,[a("div",He,[a("input",{type:"number",min:"0",value:e.equipos[s].descuento_final*100,onInput:n=>e.equipos[s].descuento_final=Math.max(0,n.target.valueAsNumber.toFixed(2)/100),class:"border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md max-w-[80px] border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,40,Re),f(),Ge])]),a("td",Je,[e.equipos[s].equipo_selec?(i(),u("p",Qe,p(_(w)(e.equipos[s].costounitario,0,1)),1)):m("",!0)]),a("td",We,[e.equipos[s].equipo_selec?(i(),u("p",Xe,p(_(w)(e.equipos[s].costototal,0,1)),1)):m("",!0)]),a("td",Ye,[q(a("input",{type:"number",step:"0.01","onUpdate:modelValue":n=>e.equipos[s].factor_final=n,class:"w-24 border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,8,et),[[H,e.equipos[s].factor_final,void 0,{number:!0}]])]),a("td",tt,[e.equipos[s].equipo_selec?(i(),u("p",ot,p(_(w)(e.equipos[s].valorunitario,0,1)),1)):m("",!0)]),a("td",at,[e.equipos[s].equipo_selec?(i(),u("p",st,p(_(w)(e.equipos[s].subtotalequip,0,1)),1)):m("",!0)]),a("td",rt,[e.equipos[s].equipo_selec?(i(),u("p",it,p(e.equipos[s].equipo_selec.alerta_mano_obra),1)):m("",!0)]),a("td",nt,[a("button",{onClick:b(n=>oe(s),["prevent"]),type:"button",onKeydown:P(b(n=>!1,["prevent"]),["enter"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}," Eliminar ",40,lt)])],2)])}),128)),a("tr",ct,[pt,dt,ut,a("th",mt,p(_(w)(e.valorItemUnitario,0,1)),1),a("th",_t,[y(me,{type:"number",class:"min-w-[40px] max-w-[80px] pl-5 border rounded-xl print:hidden",modelValue:e.cantidadItem,"onUpdate:modelValue":t[2]||(t[2]=d=>e.cantidadItem=d),modelModifiers:{number:!0},required:"",placeholder:o.lang().placeholder.cantidad},null,8,["modelValue","placeholder"])]),a("th",wt,p(ae.value),1)])]),y(be,{type:"button",onClick:t[3]||(t[3]=d=>e.showFactorModal=!0),class:"mt-4"},{default:L(()=>[f("Actualizar Factores ")]),_:1}),y(fe,{show:e.showFactorModal,onClose:t[4]||(t[4]=d=>e.showFactorModal=!1),onConfirm:re},null,8,["show"]),e.EquipsOnZero?(i(),g(J,{key:1,message:"Hay equipos sin precio"})):m("",!0),r.mostrarDetalles?(i(),g(_e,{key:2,initialEquipos:(F=e.equipos)==null?void 0:F.length,onUpdatEquipos:t[5]||(t[5]=d=>_(G)(e.equipos.length+1,e,r,r.factorSeleccionado)),class:"no-print mt-4 mb-10 mx-auto w-fit"},null,8,["initialEquipos"])):m("",!0)],32)],64)}}};export{zt as default};
