import{q as ee,l as te,k as oe,s as v,I as T,h as Z,H as ae,v as se,f as c,o as l,g as d,b as o,x as y,t as n,G as g,c as h,F as z,p as re,u as m,a as I,n as ie,e as w,w as le,d as ne}from"./app-BhGvptmL.js";import{_ as pe}from"./TextInput-XsIzkty-.js";/* empty css             */import ce from"./Add_Sub_equipos-BztWUKjl.js";import{b as de,n as _}from"./global-Dn-lfq_U.js";/* empty css                   */import{C as ue}from"./vue-select.es-CcZCZQ2N.js";import{_ as P}from"./InputError-Ck0A_nV9.js";import{r as me}from"./PencilIcon-KSwtZsAy.js";const _e={key:0,class:"text-center mx-auto mt-6 mb-2 relative drop-shadow-xl min-w-[680px] h-12 overflow-hidden rounded-xl bg-gray-800"},ye=["id"],xe={class:"text-center text-lg mx-2 w-32"},ge={class:"p-4 mb-6 grid-cols-2 gap-4 overflow-x-scroll xs:min-w-[700px] md:min-w-[1500px] 2xl:min-w-[1800px] bg-gray-50 dark:bg-gray-900 border-x-[2px] border-gray-300 dark:border-indigo-700 rounded-xl hover:shadow-indigo-300/50 dark:hover:shadow-indigo-700/50 transition-all duration-300 ease-in-out"},he={class:"divide-y-1 divide-gray-200 w-full dark:text-gray-100"},we={class:"px-3 py-2 whitespace-nowrap"},fe={class:"p-2 whitespace-nowrap mx-auto text-center max-w-[50px]"},be={class:"p-2 whitespace-nowrap min-w-[100px] max-w-[750px]"},qe={class:"hidden print:block text-sm w-full"},ke={class:"mx-auto px-0 py-2 whitespace-nowrap text-center"},ve=["onUpdate:modelValue"],Ie={key:0,class:"px-3 py-2 whitespace-nowrap mx-auto text-center dark:text-gray-100"},Ee={key:1,class:"px-3 py-2 whitespace-nowrap mx-auto text-center dark:text-gray-100"},Ve=["onUpdate:modelValue"],Ue={class:"hidden print:block text-sm"},Ce=["id"],De={class:"px-3 py-2 whitespace-nowrap mx-auto text-center"},Oe={key:0,class:"max-w-[150px] border-gray-50/75 text-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block w-full border-[0.5px] border-indigo-200 focus:border-indigo-700"},Be={class:"p-2 whitespace-nowrap align-middle dark:text-gray-100"},Ne={class:"inline-flex items-center justify-center w-full h-full"},Se=["value","onInput"],je={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ae={key:0},Me={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Te={key:0},Ze={class:"px-3 py-2 whitespace-nowrap mx-auto text-center dark:text-gray-100"},ze=["onUpdate:modelValue"],Pe={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Re={key:0},Fe={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},$e={key:0},He={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Le={key:0},Xe={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ge=["onClick"],We={class:"text-gray-900 text-lg"},Je={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Ke={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},Qe={class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},ct={__name:"EditItem",props:{item:{type:Object,required:!0},indexItem:{type:Number,required:!0},equipos:{type:Array,required:!0},mostrarDetalles:!0,plantilla:Number,CallOnce_Plantilla:!0,factores:{type:Array,default:()=>({})},factorSeleccionado:Number},emits:["updatiItems","checkzero"],setup(f,{emit:R}){const{_:Ye,debounce:F,pickBy:et}=ee,$=F(async a=>{if(!(!a||a.length<2)){console.log("ðŸš€ ~asdasdasdasdas  ~ search: ",a);try{const t=await fetch(route("api.select.equipos")+"?q="+encodeURIComponent(a),{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});e.equiposOptions=await t.json()}catch(t){alert("Error al buscar equipos:",t)}}},300),E=async a=>{if(!a)return null;try{const t=await fetch(route("api.select.equipos")+"?q="+encodeURIComponent(a));t.ok||alert("Error de red: "+t.statusText);const r=await t.json();return r.length>0?r[1]:null}catch(t){return console.error("Error buscando equipo, error:  ",t),null}},b=R,H=(a,t)=>{const r={...t};console.log(a+" :: ",r)},u=f;H("item",u.item);const e=te({daitem:Object,equipos:u.equipos,equiposOptions:[],searchEquipo:"",subtotal:0,valorItemUnitario:0,cantidadItem:0,valorItemtotal:0,EquipsOnZero:!1});oe(async()=>{await L()}),v(()=>u.item,a=>{a&&(e.daitem=a,e.equipos=a.equipos||[],e.cantidadItem=a.cantidad,T(()=>{k(e.cantidadItem),G()}))},{deep:!0});const L=async()=>{for(const t of e.equipos)if(t.equipo_selec&&t.equipo_selec.value){const r=await E(t.equipo_selec.value);r&&(t.equipo_selec=r)}const a=await E(14);console.log("ðŸš€ ~ RecuperarValueEquipos ~ asd: ",a)};function X(){let a=u.factorSeleccionado;if(!a||!Number.isInteger(u.factorSeleccionado))return;a=a-1;let r=e.equipos[e.equipos.length-1];r.factor_final=u.factores[a].value??1}function G(){e.equipos.forEach((a,t)=>{a.equipo_selec?(W(t),e.equipos[t].equipo_selec.alerta_mano_obra=a.equipo_selec.alerta_mano_obra??"No aplica"):a.descuento_final=0})}function W(a){const t=e.equipos[a],r=t.equipo_selec.descuento_basico,x=t.equipo_selec.descuento_proyectos;r>=x?e.equipos[a].descuento_final=r:e.equipos[a].descuento_final=x,console.log("ðŸš€ ~ seleccionarDescuentoMayor ~ descuentoBasico: ",r),e.equipos[a].descuento_final===null&&(e.equipos[a].descuento_final=0)}function J(a){e.equipos.splice(a,1)}function K(a){for(a<0&&(a=0);e.equipos.length<a;)e.equipos.push({nombre_item:e.daitem.nombre??"",equipo_selec:null,cantidad:1,subtotalequip:0});for(;e.equipos.length>a;)e.equipos.pop();X()}const q=Z(()=>!e.valorItemUnitario||!e.cantidadItem?0:e.valorItemUnitario*e.cantidadItem),Q=Z(()=>q.value?de(q.value):"");function k(a){e.valorItemUnitario=0,e.equipos.forEach(t=>{if(t.equipo_selec&&t.cantidad>0){(t.descuento_final>1||t.descuento_final<0)&&alert("Descuento invalido. Codigo: "+t.equipo_selec.value);const r=t.descuento_final?1-t.descuento_final:1;t.costounitario=r*t.equipo_selec.precio_de_lista,t.costototal=t.costounitario*t.cantidad,t.valorunitario=t.costounitario*t.factor_final,t.subtotalequip=t.cantidad*t.valorunitario}else t.subtotalequip=0,t.costounit=0;e.valorItemUnitario+=t.subtotalequip}),b("updatiItems",{equipos:e.equipos,valorItemUnitario:e.valorItemUnitario,TotalItem:q,indexItem:u.indexItem,cantidadItem:a,valor_total_item:e.valorItemUnitario*a,daitem:e.daitem})}const Y=a=>{e.EquipsOnZero=!1,a.forEach(t=>{var r;t.equipo_selec&&(((r=t.equipo_selec)==null?void 0:r.precio_de_lista)==0||typeof t.equipo_selec.precio_de_lista=="string")&&(e.EquipsOnZero=!0,b("checkzero",{index:u.indexItem,isZero:!0}))}),e.EquipsOnZero||b("checkzero",{index:u.indexItem,isZero:!1})};return v(()=>e.equipos,(a,t)=>{a&&t&&(T(),k(e.cantidadItem),Y(a))},{deep:!0}),v(()=>e.cantidadItem,a=>{k(a)},{deep:!0}),(a,t)=>{const r=ae("PrimaryButton"),x=se("tooltip");return l(),c(z,null,[u.mostrarDetalles?(l(),c("div",_e,[o("div",{id:"itemN"+u.indexItem,class:"absolute flex items-center justify-center text-white z-[1] rounded-xl inset-0.5 bg-gray-800 py-1"},[o("p",xe,"Item "+n(f.indexItem+1),1),y(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>e.daitem.nombre=i),class:"max-w-[880px] min-w-[480px] text-center border-0 py-0 dark:bg-gray-900 bg-gray-800 dark:text-gray-300 rounded-md mt-1 block w-full text-xl"},null,512),[[g,e.daitem.nombre]])],8,ye),t[3]||(t[3]=o("div",{class:"absolute w-56 h-48 bg-white blur-[50px] -left-1/2 -top-1/2"},null,-1))])):d("",!0),o("div",ge,[e.EquipsOnZero?(l(),h(P,{key:0,message:"Hay equipos sin precio"})):d("",!0),o("table",he,[t[11]||(t[11]=o("thead",{class:"ltr:text-left rtl:text-right"},[o("tr",{class:"*:font-medium dark:text-gray-900 bg-gray-900 text-white shadow-md rounded-xl dark:text-gray-100"},[o("th",{class:"px-3 py-2 whitespace-nowrap rounded-l-2xl dark:text-gray-100"},"#"),o("th",{class:"px-3 py-2 mx-2 min-w-[10px] dark:text-gray-100"},"CÃ³digo"),o("th",{class:"px-3 py-2 mx-2 whitespace-nowrap min-w-[150px] max-w-[700px] dark:text-gray-100"},"DescripciÃ³n"),o("th",{class:"-px-1 py-2 whitespace-nowrap max-w-[110px] dark:text-gray-100"},"Cantidad"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Precio de lista"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Descuentos"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Descuento final %"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Costo"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Costo total"),o("th",{class:"px-3 py-2 min-w-[60px] whitespace-nowrap dark:text-gray-100"},"Factor"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Valor unitario"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Subtotal"),o("th",{class:"px-3 py-2 whitespace-nowrap dark:text-gray-100"},"Alerta mano de obra"),o("th",{class:"px-3 py-2 whitespace-nowrap rounded-r-2xl dark:text-gray-100"},"Acciones")])],-1)),(l(!0),c(z,null,re(e.equipos,(i,s)=>{var V,U,C,D,O,B,N,S,j,A,M;return l(),c("tbody",{key:s,class:"divide-y divide-gray-200"},[o("tr",{class:ie(["*:text-gray-900 *:first:font-medium dark:text-gray-100",{"bg-gray-200 dark:bg-gray-700":s%2!==0}])},[o("td",we,n(s+1)+"Â°",1),o("td",fe,n(((V=i==null?void 0:i.equipo_selec)==null?void 0:V.value)??""),1),o("td",be,[I(m(ue),{modelValue:e.equipos[s].equipo_selec,"onUpdate:modelValue":p=>e.equipos[s].equipo_selec=p,options:e.equiposOptions,label:"title",filterable:!1,"append-to-body":"",placeholder:"Buscar equipo...",class:"print:hidden mt-1 block w-full min-w-[250px] fixed",onSearch:t[1]||(t[1]=p=>{e.searchEquipo=p,m($)(p)})},null,8,["modelValue","onUpdate:modelValue","options"]),o("div",qe,n(((U=i==null?void 0:i.equipo_selec)==null?void 0:U.title)??"Sin selecciÃ³n"),1)]),o("td",ke,[y(o("input",{type:"number",min:"0","onUpdate:modelValue":p=>e.equipos[s].cantidad=p,class:"dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block pl-3 max-w-[110px] mx-auto border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,8,ve),[[g,e.equipos[s].cantidad,void 0,{number:!0}]])]),((D=(C=e.equipos[s])==null?void 0:C.equipo_selec)==null?void 0:D.precio_de_lista2)!==0?(l(),c("td",Ie,[w(n(i!=null&&i.equipo_selec?m(_)(i==null?void 0:i.equipo_selec.precio_de_lista,0,1):"Sin valor")+" ",1),i?y((l(),h(r,{key:0,onClick:p=>e.equipos[s].equipo_selec.precio_de_lista2=0,class:"cursor-pointer p-0.5 h-5 w-5 inline-flex items-center rounded-full text-white bg-blue-300 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-600 ease-in-out"},{default:le(()=>[I(m(me),{class:"w-5 h-5"})]),_:2},1032,["onClick"])),[[x,"Editar"]]):d("",!0)])):(O=e.equipos[s])!=null&&O.equipo_selec?(l(),c("td",Ee,[y(o("input",{type:"number","onUpdate:modelValue":p=>e.equipos[s].equipo_selec.precio_de_lista=p,class:"no-print max-w-[120px] border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block w-full"},null,8,Ve),[[g,e.equipos[s].equipo_selec.precio_de_lista,void 0,{number:!0}]]),o("div",Ue,n((N=(B=e.equipos[s])==null?void 0:B.equipo_selec)==null?void 0:N.precio_de_lista),1),((j=(S=e.equipos[s])==null?void 0:S.equipo_selec)==null?void 0:j.precio_de_lista)==0?(l(),c("div",{key:0,id:"valor-nulo"+f.indexItem+"_"+s,class:"bg-red-600"}," Valor nulo! ",8,Ce)):d("",!0)])):d("",!0),o("td",De,[e.equipos[s].equipo_selec?(l(),c("p",Oe,[w(" Basico: "+n(((A=e.equipos[s])==null?void 0:A.equipo_selec.descuento_basico)*100)+"%",1),t[4]||(t[4]=o("br",null,null,-1)),w(" Proyectos: "+n(((M=e.equipos[s])==null?void 0:M.equipo_selec.descuento_proyectos)*100)+"%",1),t[5]||(t[5]=o("br",null,null,-1))])):d("",!0)]),o("td",Be,[o("div",Ne,[o("input",{type:"number",min:"0",max:"100",value:e.equipos[s].descuento_final*100,onInput:p=>e.equipos[s].descuento_final=Math.max(0,p.target.valueAsNumber/100||0),class:"border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md max-w-[80px] border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,40,Se),t[6]||(t[6]=w()),t[7]||(t[7]=o("span",{class:"mx-2 w-1/6"}," %",-1))])]),o("td",je,[e.equipos[s].equipo_selec?(l(),c("p",Ae,n(m(_)(e.equipos[s].costounitario,0,1)),1)):d("",!0)]),o("td",Me,[e.equipos[s].equipo_selec?(l(),c("p",Te,n(m(_)(e.equipos[s].costototal,0,1)),1)):d("",!0)]),o("td",Ze,[y(o("input",{type:"number",step:"0.01","onUpdate:modelValue":p=>e.equipos[s].factor_final=p,min:"0",class:"min-w-[75px] max-w-32 border-gray-50/75 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md mt-1 block border-[0.5px] border-indigo-200 focus:border-indigo-700"},null,8,ze),[[g,e.equipos[s].factor_final,void 0,{number:!0}]])]),o("td",Pe,[e.equipos[s].equipo_selec?(l(),c("p",Re,n(m(_)(e.equipos[s].valorunitario,0,1)),1)):d("",!0)]),o("td",Fe,[e.equipos[s].equipo_selec?(l(),c("p",$e,n(m(_)(e.equipos[s].subtotalequip,0,1)),1)):d("",!0)]),o("td",He,[e.equipos[s].equipo_selec?(l(),c("p",Le,n(e.equipos[s].equipo_selec.alerta_mano_obra),1)):d("",!0)]),o("td",Xe,[o("button",{onClick:ne(p=>J(s),["prevent"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}," Eliminar ",8,Ge)])],2)])}),128)),o("tr",We,[t[8]||(t[8]=o("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1)),t[9]||(t[9]=o("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1)),t[10]||(t[10]=o("th",{class:"px-3 py-2 whitespace-nowrap"},"-",-1)),o("th",Je,n(m(_)(e.valorItemUnitario,0,1)),1),o("th",Ke,[I(pe,{type:"number",class:"min-w-[40px] max-w-[80px] pl-5 border rounded-xl print:hidden",modelValue:e.cantidadItem,"onUpdate:modelValue":t[2]||(t[2]=i=>e.cantidadItem=i),modelModifiers:{number:!0},required:"",placeholder:a.lang().placeholder.cantidad},null,8,["modelValue","placeholder"])]),o("th",Qe,n(Q.value),1)])]),e.EquipsOnZero?(l(),h(P,{key:1,message:"Hay equipos sin precio"})):d("",!0),u.mostrarDetalles?(l(),h(ce,{key:2,initialEquipos:e.equipos.length,onUpdatEquipos:K,class:"no-print mt-4 mb-10 mx-auto w-fit"},null,8,["initialEquipos"])):d("",!0)])],64)}}};export{ct as default};
