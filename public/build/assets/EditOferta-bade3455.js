import{T as M,k as U,j as L,z as Z,f as u,a as p,b as r,g as w,e as A,u as c,F as h,m as y,v as x,B as k,t as I,c as O,o as d,n as P,a0 as V}from"./app-551012d8.js";import{T as H}from"./Toast-07128877.js";/* empty css             *//* empty css                   */import R from"./EditItem-9c626b80.js";import G from"./CerrarYguardar-a1c53782.js";import C from"./Add_Sub_items-ca05234a.js";import K from"./formOfertaEdit-b1b646f6.js";import{n as J}from"./global-6d1c7c87.js";import{E as Q}from"./ErroresNuevaOferta-766563ec.js";import{d as W}from"./focusStore-50e14bee.js";/* empty css                                              */import"./_plugin-vue_export-helper-c27b6911.js";import"./TextInput-4b8270d6.js";import"./Add_Sub_equipos-f939d446.js";import"./vue-select.es-e7a5a940.js";import"./InputError-23c0a787.js";import"./FactorModal-3003c42d.js";import"./Modal-e8455b5b.js";import"./PrimaryButton-bd076b11.js";import"./SecondaryButton-ec5b0153.js";import"./PencilIcon-7035d21d.js";const X=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13l-3 3m0 0l-3-3m3 3V8m0 13a9 9 0 110-18 9 9 0 010 18z"})],-1),Y=[X],ee=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13l-3 3m0 0l-3-3m3 3V8m0 13a9 9 0 110-18 9 9 0 010 18z"})],-1),oe=[ee],te=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"})],-1),ae=[te],re={class:"space-y-6"},se={key:0,class:"flex justify-center mt-6 mb-2"},le=r("img",{src:"/demco-logo-ultimo.png",alt:"Logo Demco",class:"h-12"},null,-1),ie=[le],ne=["onSubmit"],ce={class:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-6 gap-6 p-4"},de=["for"],me=["id","onUpdate:modelValue","placeholder"],ue={class:"col-span-1 relative bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 ease-in-out overflow-hidden"},pe={class:"p-4"},fe=r("label",{class:"block font-semibold text-gray-700 dark:text-gray-300 mb-2"}," Factor seleccionado ",-1),ge={class:"text-gray-600 body-font"},he={class:"container mx-auto"},be={class:"flex flex-col text-center mx-auto w-full max-w-[300px] bg-white py-4 mt-12 mb-20 rounded-xl border border-collapse border-green-400"},_e=r("h1",{class:"sm:text-xl text-lg font-medium title-font mb-4 text-gray-900"}," Valor total de la oferta ",-1),ve={class:"text-2xl lg:w-2/3 mx-auto leading-relaxed"},we=r("hr",{class:"border-[1px] border-black my-8 col-span-full"},null,-1),Ae={__name:"EditOferta",props:{numberPermissions:Number,ultimaCD:Number,theuser:Object,oferta:Object},setup(b){const i=b;let F=0;const t=M({dataOferta:{cliente:"",codigo_oferta:"CD"+i.ultimaCD,descripcion:"DEMCO INGENIERÍA, es una empresa dinámica dedicada al diseño, construcción y puesta en servicio de subestaciones y tableros eléctricos en media y baja tensión, desarrollando proyectos con altas especificaciones en ingeniería, en alianza con reconocidas empresas del sector eléctrico. Entregamos a nuestros clientes soluciones completas e integrales respaldados por procesos de ingeniería y automatización, ágiles y con importantes alianzas con reconocidas empresas del sector. Somos una empresa Colombiana con proyección hacia el futuro, contamos con productos de calidad, precios competitivos, recurso humano calificado, capacidad operativa y respuesta oportuna a nuestros cliente.",cargo:"",empresa:"",ciudad:"Medellín",proyecto:""},items:[],equipos:[],ultra_valor_total:0}),s=U({params:{pregunta:""},mostrarDetalles:!0,EquipsOnZero:!1,hijosZeroFlags:[],factores:[{title:"Factor Suministro",value:1.33},{title:"Factor MT",value:1.5},{title:"Factor BT",value:1.6},{title:"Factor Cobre",value:1.55},{title:"Factor por Ingenieria Adicional",value:1}],factorSeleccionado:1,onmountedisOk:!1});function E(){i.oferta.cargo?t.dataOferta.cargo=i.oferta.cargo:t.dataOferta.cargo=i.theuser.cargo?i.theuser.cargo:" El usuario no tiene cargo asignado"}L(()=>{s.onmountedisOk=!0,E();let o=0;t.items=i.oferta.items.map((e,a)=>(o+=parseFloat(e.valor_total_item)||0,{id:e.id,nombre:e.nombre,descripcion:e.descripcion,cantidadItem:e.cantidad,valorItemUnitario:parseFloat(e.valor_unitario_item),valor_total:parseFloat(e.valor_total_item)})),t.equipos=i.oferta.items.map(e=>e.equipos&&e.equipos.length>0?e.equipos.map(a=>({equipo_selec:{value:a.pivot.codigoGuardado,label:`${a.codigo} - ${a.descripcion}`,precio_de_lista:a.pivot.precio_de_lista,descuento_basico:a.pivot.descuento_basico,descuento_proyectos:a.pivot.descuento_proyectos,alerta_mano_obra:a.pivot.alerta_mano_obra,pivot:a.pivot},nombre_item:e.nombre,cantidad:a.pivot.cantidad_equipos,factor_final:a.pivot.factor,descuento_final:a.pivot.descuento_final,costounitario:parseFloat(a.pivot.costo_unitario),costototal:parseFloat(a.pivot.costo_total),valorunitario:parseFloat(a.pivot.valorunitarioequip),subtotalequip:parseFloat(a.pivot.subtotalequip)})):[]),t.cantidadesItem=i.oferta.items.map(e=>e.cantidad),t.valores_total_items=i.oferta.items.map(e=>parseFloat(e.valor_total_item)),t.ultra_valor_total=o,Z(),f()});function f(){t.ultra_valor_total=t.items.reduce((o,e)=>{const a=parseFloat(e.valor_total)||0;return o+a},0)}function S(o,e){t.items[o]&&(t.items[o]=e,f())}function z(o,e){t.items[o]&&(t.items[o].nombre=e)}function D(o){_({index:o,isok:!1}),W(o,t,s,f),console.log("achu",s.hijosZeroFlags)}function g(o){for(;t.items.length<o;)t.items.push({id:F++,nombre:`Item ${t.items.length+1}`,cantidad:1,equipos:[],valor_total:0});for(;t.items.length>o;)t.items.pop();f()}function _({index:o,isZero:e}){s.hijosZeroFlags[o]=e,s.EquipsOnZero=s.hijosZeroFlags.includes(!0)}function j(){i.numberPermissions>9&&$(),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}function N(){const o=Array.from(document.querySelectorAll('[id^="itemN"]'));let e=-1;const a=window.innerHeight;o.forEach((l,n)=>{const m=l.getBoundingClientRect();m.bottom>0&&m.top<a&&(e=n)}),e>=0&&e<o.length-1&&o[e+1].scrollIntoView({behavior:"smooth",block:"center"})}function T(){const o=Array.from(document.querySelectorAll('[id^="itemN"]'));let e=-1;const a=window.innerHeight;o.forEach((l,n)=>{const m=l.getBoundingClientRect();m.bottom>0&&m.top<a&&(e=n)}),e>=0&&e<o.length-1&&e>0?o[e-1].scrollIntoView({behavior:"smooth",block:"center"}):window.scrollTo(0,0)}function $(){V.forEach(t.items,o=>{V.forEach(o.equipos,e=>{e&&e.equipo_selec&&(e.equipo_selec.precio_de_lista==0||e.equipo_selec.precio_de_lista==null)&&(e.equipo_selec.precio_de_lista=111)})})}function B(){const o=!(!t.dataOferta.cargo||!t.dataOferta.empresa);return o||alert("Los campos cargo y empresa son obligatorios"),o}function q(){let o=t.items.length>0;return o||alert("Debe haber al menos un item en la oferta"),o}const v=()=>{q()&&B()?t.post(route("GuardarEditOferta",{oferta:i.oferta.id}),{preserveScroll:!0,onSuccess:()=>{},onError:()=>null,onFinish:()=>null}):alert("Hay campos vacios o no hay items")};return window.addEventListener("keydown",o=>{if(o.ctrlKey&&o.key.toLowerCase()==="a"){o.preventDefault();const e=t.items.length+1;g(e)}}),(o,e)=>(d(),u(h,null,[p(H,{flash:o.$page.props.flash},null,8,["flash"]),r("button",{onClick:j,class:"fixed top-4 left-4 z-50 bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-3 rounded-full shadow-lg","aria-label":"Ir a Valor nulo!"},Y),r("button",{onClick:N,class:"fixed top-24 left-4 z-50 bg-amber-500 hover:bg-orange-700 text-white font-bold py-3 px-3 rounded-full shadow-lg","aria-label":"Siguiente item"},oe),r("button",{onClick:T,class:"fixed top-4 right-4 z-50 bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-3 rounded-full shadow-lg","aria-label":"Anterior item"},ae),r("section",re,[s.mostrarDetalles?(d(),u("div",se,ie)):w("",!0),r("form",{onSubmit:A(v,["prevent"]),class:"px-16 py-1 2xl:px-8 2xl:py-4 print-container"},[p(K,{modelValue:c(t).dataOferta,"onUpdate:modelValue":e[0]||(e[0]=a=>c(t).dataOferta=a),dataOferta:i.oferta},null,8,["modelValue","dataOferta"]),r("div",ce,[(d(!0),u(h,null,y(s.factores,(a,l)=>(d(),u("div",{key:l,class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 ease-in-out overflow-hidden"},[r("div",{class:P([{"bg-indigo-100 dark:bg-indigo-900":l==s.factorSeleccionado-1},"p-4"])},[r("label",{for:`factor-input-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},I(a.title),9,de),x(r("input",{id:`factor-input-${l}`,type:"text","onUpdate:modelValue":n=>s.factores[l].value=n,class:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-base text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:`Ingresa ${a.title.toLowerCase()}`},null,8,me),[[k,s.factores[l].value]])],2)]))),128)),r("div",ue,[r("div",pe,[fe,x(r("input",{type:"number",min:"0",max:"5","onUpdate:modelValue":e[1]||(e[1]=a=>s.factorSeleccionado=a),class:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-base text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[k,s.factorSeleccionado,void 0,{number:!0}]])])])]),p(C,{initialItems:c(t).items.length,onUpdateItems:g,class:""},null,8,["initialItems"]),(d(!0),u(h,null,y(c(t).items,(a,l)=>{var n;return d(),O(R,{key:a.id,item:a,equipos:(n=b.oferta.items[l])==null?void 0:n.equipos,indexItem:l,mostrarDetalles:s.mostrarDetalles,plantilla:i.plantilla,factores:s.factores,factorSeleccionado:s.factorSeleccionado,onmountedisOk:s.onmountedisOk,onUpd_itemname:z,onUpdateItem:S,onCheckzero:_,onDeleteItem:D,class:"mb-4"},null,8,["item","equipos","indexItem","mostrarDetalles","plantilla","factores","factorSeleccionado","onmountedisOk"])}),128)),p(Q,{errors:Object.values(o.$page.props.errors)},null,8,["errors"]),p(C,{initialItems:c(t).items.length,onUpdateItems:g,class:"text-center mx-auto w-fit"},null,8,["initialItems"]),r("section",ge,[r("div",he,[r("div",be,[_e,r("p",ve,I(c(J)(c(t).ultra_valor_total,0,1)),1)])])]),we,s.EquipsOnZero?w("",!0):(d(),O(G,{key:0,ruta:"Oferta.index",formProcessing:c(t).processing,onCreate:v,class:"mb-20 pb-10"},null,8,["ruta","formProcessing"]))],40,ne)])],64))}};export{Ae as default};
