import{l as F,T as H,k as P,m as z,s as E,f as n,o as c,a as l,w as V,b as d,d as G,g as m,t as g,e as T,u as a,F as q,p as I,n as J}from"./app-BhGvptmL.js";import{_ as j}from"./InputError-Ck0A_nV9.js";import{_ as k}from"./InputLabel-Fsg0RhcG.js";import{_ as W}from"./Modal-CWveoFge.js";import{_ as K}from"./PrimaryButton-BkUg86Bs.js";import{_ as Q}from"./SecondaryButton-sXq2m4Kv.js";import{_ as x}from"./TextInput-XsIzkty-.js";import{C as b}from"./vue-select.es-CcZCZQ2N.js";/* empty css                   *//* empty css             */import{c as A,D as X,T as Y}from"./global-Dn-lfq_U.js";const Z={class:"space-y-6 dark:text-white"},ee={class:"text-lg font-medium text-gray-900 dark:text-white"},oe={class:"grid xs:grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},ae={key:0,id:"opcinesActividadO",class:"xl:col-span-2 col-span-1"},te={id:"opcinesActividadO",class:"xs:col-span-1 xl:col-span-2"},ie={class:"xs:col-span-1 xl:col-span-1"},le={class:"dark:text-white col-span-1"},se={id:"Scentrotrabajo",class:"xs:col-span-1 xl:col-span-1"},re={key:1,id:"Sordentrabajo",class:"xl:col-span-1 xs:col-span-1"},de={key:2,class:"xl:col-span-1 xs:col-span-1"},ne={key:3,class:"mt-6"},ce={key:4,class:"w-full xl:col-span-2 xs:col-span-1 dark:text-white"},ue={key:5,class:"w-full col-span-1 dark:text-white"},me={key:6,class:"col-span-1 dark:text-white"},pe={key:7,id:"actividad",class:"xl:col-span-2 col-span-1"},be={key:8,id:"reproceso",class:"xl:col-span-2 col-span-1"},_e={key:9,id:"disponibilidad",class:"xl:col-span-3 col-span-1"},fe={key:0,class:"mt-5 p-4 bg-yellow-100 border border-yellow-400 text-yellow-700 dark:text-red-400"},ve={class:"list-disc list-inside"},ge={class:"mb-8 mt-[360px] flex justify-end"},je={key:0,class:"mx-12 px-8 text-lg font-medium text-red-600 bg-red-50 dark:text-red-400 dark:bg-gray-800"},ke={key:1,class:"mx-12 px-8 text-lg font-medium text-gray-800 dark:text-white dark:bg-gray-800"},De={__name:"Create",props:{show:Boolean,title:String,roles:Object,losSelect:Object,numberPermissions:Number,valuesGoogleCabeza:Object,valuesGoogleBody:Object,Trabajadores:Object,losOT:Object},emits:["close"],setup(D,{emit:N}){const u=D,w=N,i=F({params:{pregunta:""},actividad_id:u.losSelect.actividad,centrotrabajo_id:u.losSelect.centrotrabajo,disponibilidad_id:u.losSelect.disponibilidad,ordentrabajo_id:u.losSelect.ordentrabajo,reproceso_id:u.losSelect.reproceso,temp_disponibilidad_id:null,temp_reproceso_id:null,temp_actividad_id:null,valorInactivo:"NA",cabeza:u.valuesGoogleCabeza,nombresOT:Object.values(u.valuesGoogleBody),mensajeFalta:"",BanderaTipo:!0,mensajeTiemposAuto:"",limiteMinimo:"",ordentrabajo_ids:[],ot2:[],tenemosCentro:!1,soloParaOfertas:!1}),e=H({...Object.fromEntries(["tipoReporte","fecha","hora_inicial","hora_final","actividad_id","centrotrabajo_id","disponibilidad_id","operario_id","ordentrabajo_id","reproceso_id","ordentrabajo_ids","otitem","user_id","numero_oferta","OTItem","TiempoEstimado","ot_id"].map(t=>[t,""]))}),O=()=>{let t=new Date;t.setHours(t.getHours()-1);let o=r=>r<10?`0${r}`:r;return`${o(t.getHours())}:${o(t.getMinutes())}`},B=t=>(t.preventDefault(),!1);P(()=>{i.limiteMinimo=O(),setInterval(()=>{i.limiteMinimo=O()},6e4),document.body.addEventListener("contextmenu",B),i.ordentrabajo_ids=i.nombresOT.map(t=>{var o;return{title:(o=t.numero_oferta)==null?void 0:o.replace(/_/g," "),value:t.id}}),i.ot2=i.nombresOT.map(t=>{var o;return{title:(o=t.ot)==null?void 0:o.replace(/_/g," "),value:t.id}})});let h=t=>{let o="";try{t.forEach(r=>{if(typeof e[r]>"u"||e[r]===null||e[r].value===null||e[r].length===0)throw o=r,new Error("BreakException")})}catch{}return o},U=()=>{let t=e.tipoReporte.value,o=!0;const r=". Campo obligatorio";let _=new Date().getHours(),f=X(_+":00",e.hora_inicial);if(e.actividad_id==null||e.actividad_id.value===0)return"Hay campos vacios";if(f>0)return"Ha pasado mucho tiempo!";t===0&&(o=h(["centrotrabajo_id","actividad_id"])),t===1&&(o=h(["centrotrabajo_id","actividad_id","reproceso_id"])),t===2&&(o=h(["centrotrabajo_id","disponibilidad_id"]));let v={ordentrabajo_ids:"Orden trabajo",actividad_id:"Actividad",reproceso_id:"Reproceso",centrotrabajo_id:"Centro de trabajo",disponibilidad_id:"Disponibilidad"};return o!==""?v[o]+r:o};z(()=>{var t,o,r,_,f,v;if(u.show){if(i.BanderaTipo&&(e.tipoReporte={title:"Actividad",value:0},i.BanderaTipo=!1),e.errors={},e.fecha===null||e.fecha===""){let p=new Date;e.fecha=Y(p).substring(0,10),e.hora_inicial=A()}if(e.ordentrabajo_ids&&e.ordentrabajo_ids.value||e.ot_id&&e.ot_id.id){console.table(i.nombresOT.slice(0,10));let p;i.tenemosCentro=!1,e.ordentrabajo_ids&&((o=(t=e.centrotrabajo_id)==null?void 0:t.title)==null?void 0:o.toLowerCase())==="ofertas"?(i.tenemosCentro=!0,p=i.nombresOT.find(y=>y.id===e.ordentrabajo_ids.value)):e.ot_id&&((_=(r=e.centrotrabajo_id)==null?void 0:r.title)==null||_.toLowerCase()),i.tenemosCentro&&(e.avance=p.avance,e.cliente=p.cliente,e.TiempoEstimado=p.tiempo_estimado)}i.soloParaOfertas=(e.ordentrabajo_ids||e.ot_id)&&e.tipoReporte.value!==2&&((v=(f=e.centrotrabajo_id)==null?void 0:f.title)==null?void 0:v.toLowerCase())==="ofertas"}else i.BanderaTipo=!0}),E(()=>e.tipoReporte,()=>{e.actividad_id=null,e.centrotrabajo_id=null,e.disponibilidad_id=null,e.operario_id=null,e.ordentrabajo_id=null,e.reproceso_id=null,e.ordentrabajo_ids=null,e.numero_oferta=null,e.TiempoEstimado=null}),E(()=>e.centrotrabajo_id,t=>{if(t&&typeof t.value<"u"){let o="centrotrabajo"+t.title;i.actividad_id=u.losSelect[o],e.ordentrabajo_ids=null,e.ot_id=null,e.avance=null,e.cliente=null,e.TiempoEstimado=null,i.tenemosCentro=!1,u.numberPermissions>9&&setTimeout(()=>{e.actividad_id=i.actividad_id[1]},120)}e.actividad_id={title:"Seleccione actividad",value:null}});const C=()=>{e.ordentrabajo_id=e.ordentrabajo_ids,i.mensajeFalta=U(),e.hora_inicial=A(),i.mensajeFalta===""&&setTimeout($(),500)},$=()=>(e.post(route("reporte.store"),{preserveScroll:!0,onSuccess:()=>{w("close"),e.reset()},onError:()=>alert(JSON.stringify(e.errors,null,4)),onFinish:()=>null}),null),L=[{title:"Actividad",value:0},{title:"Reproceso",value:1},{title:"Disponibilidad (paro)",value:2}];return(t,o)=>(c(),n("section",Z,[l(W,{show:u.show,onClose:o[12]||(o[12]=r=>w("close")),maxWidth:"4xl"},{default:V(()=>{var r,_,f,v,p,y,R,S;return[d("form",{class:"px-6 my-8",onSubmit:G(C,["prevent"])},[d("h2",ee,g(t.lang().label.add)+" "+g(u.title),1),d("div",oe,[u.numberPermissions>1?(c(),n("div",ae,[o[13]||(o[13]=d("label",{class:"dark:text-white",name:""},[T(" Reportar en nombre de: "),d("small",null,"(Opcional) ")],-1)),l(a(b),{options:u.Trabajadores,label:"title",class:"dark:bg-gray-400",modelValue:a(e).user_id,"onUpdate:modelValue":o[0]||(o[0]=s=>a(e).user_id=s)},null,8,["options","modelValue"])])):m("",!0),d("div",te,[o[14]||(o[14]=d("label",{class:"dark:text-white"}," Tipo de reporte ",-1)),l(a(b),{options:L,label:"title",class:"dark:bg-gray-400",modelValue:a(e).tipoReporte,"onUpdate:modelValue":o[1]||(o[1]=s=>a(e).tipoReporte=s)},null,8,["modelValue"])]),d("div",ie,[l(k,{for:"fecha",value:t.lang().label.fecha,class:"dark:text-white"},null,8,["value"]),l(x,{id:"fecha",type:"date",class:"mt-1 block w-full bg-gray-200 dark:text-white",modelValue:a(e).fecha,"onUpdate:modelValue":o[2]||(o[2]=s=>a(e).fecha=s),disabled:"",placeholder:"fecha",error:a(e).errors.fecha},null,8,["modelValue","error"]),l(j,{class:"mt-2",message:a(e).errors.fecha},null,8,["message"])]),d("div",le,[l(k,{for:"hora_inicial",value:t.lang().label["hora inicial"]},null,8,["value"]),l(x,{id:"hora_inicial",type:"time",class:"mt-1 block w-full",disabled:"",modelValue:a(e).hora_inicial,"onUpdate:modelValue":o[3]||(o[3]=s=>a(e).hora_inicial=s),placeholder:"hora_inicial",error:a(e).errors.hora_inicial,step:"60"},null,8,["modelValue","error"]),l(j,{class:"mt-2",message:a(e).errors.hora_inicial},null,8,["message"])]),d("div",se,[o[15]||(o[15]=d("label",{name:"centrotrabajo_id",class:"dark:text-white"}," Centro de trabajo ",-1)),l(a(b),{options:i.centrotrabajo_id,label:"title",class:"dark:bg-gray-400",modelValue:a(e).centrotrabajo_id,"onUpdate:modelValue":o[4]||(o[4]=s=>a(e).centrotrabajo_id=s)},null,8,["options","modelValue"]),l(j,{class:"mt-2",message:a(e).errors.centrotrabajo_id},null,8,["message"])]),a(e).tipoReporte.value!==2&&((_=(r=a(e).centrotrabajo_id)==null?void 0:r.title)==null?void 0:_.toLowerCase())==="ofertas"?(c(),n("div",re,[o[16]||(o[16]=d("label",{class:"dark:text-white"}," Número de oferta ",-1)),l(a(b),{options:i.ordentrabajo_ids,label:"title",class:"dark:bg-gray-400",modelValue:a(e).ordentrabajo_ids,"onUpdate:modelValue":o[5]||(o[5]=s=>a(e).ordentrabajo_ids=s)},null,8,["options","modelValue"])])):a(e).tipoReporte.value!==2&&((v=(f=a(e).centrotrabajo_id)==null?void 0:f.title)==null?void 0:v.toLowerCase())==="proyectos"?(c(),n("div",de,[o[17]||(o[17]=d("label",{name:"ot_id",class:"dark:text-white"}," Número de OT ",-1)),l(a(b),{options:u.losOT,label:"nombre",class:"dark:bg-gray-400",modelValue:a(e).ot_id,"onUpdate:modelValue":o[6]||(o[6]=s=>a(e).ot_id=s)},null,8,["options","modelValue"]),l(j,{class:"mt-2",message:a(e).errors.ordentrabajo_id},null,8,["message"])])):a(e).tipoReporte.value!==2&&((y=(p=a(e).centrotrabajo_id)==null?void 0:p.title)==null?void 0:y.toLowerCase())!=="ofertas"&&((S=(R=a(e).centrotrabajo_id)==null?void 0:R.title)==null?void 0:S.toLowerCase())!=="proyectos"?(c(),n("div",ne," Seleccione centro de trabajo ")):m("",!0),i.soloParaOfertas?(c(),n("div",ce,[l(k,{for:t.index,value:"Cliente",class:""},null,8,["for"]),l(x,{id:t.index,type:"text",disabled:"",class:"mt-1 block w-full bg-gray-200",value:a(e).cliente},null,8,["id","value"])])):m("",!0),i.soloParaOfertas?(c(),n("div",ue,[l(k,{for:t.index,value:"% avance"},null,8,["for"]),l(x,{id:t.index,type:"text",disabled:"",class:"mt-1 block w-full bg-gray-200",value:a(e).avance},null,8,["id","value"])])):m("",!0),i.soloParaOfertas?(c(),n("div",me,[l(k,{for:t.index,value:"Tiempo estimado"},null,8,["for"]),l(x,{id:t.index,type:"text",disabled:"",class:"mt-1 block w-full bg-gray-200 dark:bg-gray-400 dark:text-white",modelValue:a(e).TiempoEstimado,"onUpdate:modelValue":o[7]||(o[7]=s=>a(e).TiempoEstimado=s)},null,8,["id","modelValue"])])):m("",!0),a(e).tipoReporte.value===0||a(e).tipoReporte.value===1?(c(),n("div",pe,[o[18]||(o[18]=d("label",{name:"actividad_id",class:"dark:text-white"}," Actividad ",-1)),l(a(b),{options:i.actividad_id,label:"title",required:"",modelValue:a(e).actividad_id,"onUpdate:modelValue":o[8]||(o[8]=s=>a(e).actividad_id=s),class:"dark:bg-gray-400"},null,8,["options","modelValue"]),l(j,{class:"mt-2",message:a(e).errors.actividad_id},null,8,["message"])])):m("",!0),a(e).tipoReporte.value===1?(c(),n("div",be,[o[19]||(o[19]=d("label",{name:"reproceso_id",class:"dark:text-white"}," Reproceso",-1)),l(a(b),{options:i.reproceso_id,label:"title",required:"",modelValue:a(e).reproceso_id,"onUpdate:modelValue":o[9]||(o[9]=s=>a(e).reproceso_id=s),class:"dark:bg-gray-400"},null,8,["options","modelValue"]),l(j,{class:"mt-2",message:a(e).errors.reproceso_id},null,8,["message"])])):m("",!0),a(e).tipoReporte.value===2?(c(),n("div",_e,[o[20]||(o[20]=d("label",{name:"disponibilidad_id",class:"dark:text-white"}," Disponibilidad",-1)),l(a(b),{options:i.disponibilidad_id,label:"title",required:"",modelValue:a(e).disponibilidad_id,"onUpdate:modelValue":o[10]||(o[10]=s=>a(e).disponibilidad_id=s),class:"dark:bg-gray-400"},null,8,["options","modelValue"]),l(j,{class:"mt-2",message:a(e).errors.disponibilidad_id},null,8,["message"])])):m("",!0)]),Object.keys(a(e).errors).length>0?(c(),n("div",fe,[o[21]||(o[21]=d("p",null,"Errores detectados:",-1)),d("ul",ve,[(c(!0),n(q,null,I(a(e).errors,(s,M)=>(c(),n("li",{key:M},g(s),1))),128))])])):m("",!0),d("div",ge,[i.mensajeFalta!==""?(c(),n("h2",je,g(i.mensajeFalta),1)):m("",!0),i.mensajeTiemposAuto!==""?(c(),n("h2",ke,g(i.mensajeTiemposAuto),1)):m("",!0),l(Q,{disabled:a(e).processing,onClick:o[11]||(o[11]=s=>w("close"))},{default:V(()=>[T(g(t.lang().button.close),1)]),_:1},8,["disabled"]),l(K,{class:J(["ml-3",{"opacity-25":a(e).processing}]),disabled:a(e).processing,onClick:C},{default:V(()=>[T(g(a(e).processing?t.lang().button.add+"...":t.lang().button.add),1)]),_:1},8,["class","disabled"])])],32)]}),_:1},8,["show"])]))}};export{De as default};
