import{T as M,l as H,k as R,I as L,f as m,o as d,a as p,b as l,g as _,d as G,c as y,u as n,F as g,p as x,x as k,G as I,t as V,w as J,e as K,J as O,n as Q}from"./app-BhGvptmL.js";import{T as W}from"./Toast-DwfMDwwm.js";/* empty css             *//* empty css                   */import X from"./EditItem-DMJ50xBF.js";import Y from"./CerrarYguardar-CkJn2v-6.js";import C from"./Add_Sub_items-D41dib_0.js";import oo from"./formOfertaEdit-CPNrtAxP.js";import{n as to,p as E,a as N}from"./global-Dn-lfq_U.js";import{_ as eo}from"./PrimaryButton-BkUg86Bs.js";import{E as ao}from"./ErroresNuevaOferta-BPRT1ZWQ.js";/* empty css                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-XsIzkty-.js";import"./Add_Sub_equipos-BztWUKjl.js";import"./vue-select.es-CcZCZQ2N.js";import"./InputError-Ck0A_nV9.js";import"./PencilIcon-KSwtZsAy.js";import"./SecondaryButton-sXq2m4Kv.js";const lo={class:"space-y-6"},ro={key:0,class:"flex justify-center mt-6 mb-2"},so={class:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-6 gap-6 p-4"},io=["for"],no=["id","onUpdate:modelValue","placeholder"],co={class:"col-span-1 relative bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 ease-in-out overflow-hidden"},uo={class:"p-4"},mo={class:"text-gray-600 body-font"},po={class:"container mx-auto"},fo={class:"flex flex-col text-center mx-auto w-full max-w-[300px] bg-white py-4 mt-12 mb-20 rounded-xl border border-collapse border-green-400"},go={class:"text-2xl lg:w-2/3 mx-auto leading-relaxed"},bo={class:"flex justify-center text-center my-4"},zo={__name:"EditOferta",props:{numberPermissions:Number,ultimoIdMasUno:Number,oferta:Object},setup(q){const u=q,t=M({dataOferta:{codigo_oferta:"",descripcion:"",cargo:"",empresa:"",ciudad:"",proyecto:""},equipos:[],daItems:[],valores_total_items:[],cantidadesItem:[],ultra_valor_total:0}),r=H({params:{pregunta:""},isReady:!1,mostrarDetalles:!0,EquipsOnZero:!1,CallOnce_Plantilla:!0,hijosZeroFlags:{},factores:[{title:"Factor Suministro",value:1.33},{title:"Factor MT",value:1.5},{title:"Factor BT",value:1.6},{title:"Factor Cobre",value:1.55},{title:"Factor por Ingenieria Adicional",value:1}],factorSeleccionado:1});R(()=>{if(u.oferta){const a=u.oferta.items.length;t.daItems=new Array(a).fill(null),t.equipos=new Array(a).fill(null).map(()=>[]),t.cantidadesItem=new Array(a).fill(1),t.valores_total_items=new Array(a).fill(0),u.oferta.items.forEach((o,s)=>{t.cantidadesItem[s]=o.cantidad,t.valores_total_items[s]=parseFloat(o.valor_total_item),t.daItems[s]={nombre:o.nombre,descripcion:o.descripcion},o.equipos&&o.equipos.length>0&&(t.equipos[s]=o.equipos.map(e=>({equipo_selec:{value:e.pivot.codigoGuardado,label:`${e.codigo} - ${e.descripcion}`,precio_de_lista:e.pivot.precio_de_lista,descuento_basico:e.pivot.descuento_basico,descuento_proyectos:e.pivot.descuento_proyectos,alerta_mano_obra:e.pivot.alerta_mano_obra,...e,pivot:e.pivot},nombre_item:o.nombre,cantidad:e.pivot.cantidad_equipos,factor_final:e.pivot.factor,descuento_final:e.pivot.descuento_final,costounitario:e.pivot.costo_unitario,costototal:e.pivot.costo_total,valorunitario:e.pivot.valorunitarioequip,subtotalequip:e.pivot.subtotalequip})),console.log("ðŸš€ ~  ~ form.equipos: ",t.equipos))}),t.ultra_valor_total,b(),r.isReady=!0}});function b(){L(),t.ultra_valor_total=0,t.valores_total_items.forEach(a=>{t.ultra_valor_total+=a||0})}function T({equipos:a,valorItemUnitario:o,TotalItem:s,indexItem:e,cantidadItem:c,valor_total_item:i,daitem:U}){t.daItems[e]=U||{equipo_selec:null,cantidad:1},t.equipos[e]=a,t.valorItemUnitario=o,t.TotalItem=s;let w=0;a.forEach(f=>{f.equipo_selec&&(w=f.cantidad*f.equipo_selec.precio_de_lista,f.subtotalequip)}),e>=t.valores_total_items.length&&(t.valores_total_items.length=e+1),t.cantidadesItem[e]=c,t.valores_total_items[e]=i||0,b()}function h(a){for(;t.daItems.length<a;)t.daItems.push({equipo_selec:null,cantidad:1}),t.equipos=E(t.equipos),r.hijosZeroFlags=E(r.hijosZeroFlags),t.valores_total_items.push(1),t.cantidadesItem.push();for(;t.daItems.length>a;)t.daItems.pop(),t.equipos=N(t.equipos),r.hijosZeroFlags=N(r.hijosZeroFlags),t.valores_total_items.pop(),t.cantidadesItem.pop();b(),r.CallOnce_Plantilla=!1}function F({index:a,isZero:o}){r.hijosZeroFlags[a]=o,r.EquipsOnZero=Object.values(r.hijosZeroFlags).includes(!0)}function j(){u.numberPermissions>9&&z();const a=document.querySelectorAll('[id^="valor-nulo"]');if(a.length===0){window.scrollTo(0,document.body.scrollHeight);return}for(const o of a)if(o.offsetParent!==null){o.scrollIntoView({behavior:"smooth",block:"center"});break}}function S(){const a=Array.from(document.querySelectorAll('[id^="itemN"]'));let o=-1;const s=window.innerHeight;a.forEach((e,c)=>{const i=e.getBoundingClientRect();console.log("ðŸš€ ~ scrollToNextItem ~ rect.top: ",i.top),console.log("ðŸš€ ~ scrollToNextItem ~ rect.bottom: ",i.bottom),i.bottom>0&&i.top<s&&(o=c)}),o>=0&&o<a.length-1&&a[o+1].scrollIntoView({behavior:"smooth",block:"center"})}function $(){const a=Array.from(document.querySelectorAll('[id^="itemN"]'));let o=-1;const s=window.innerHeight;a.forEach((e,c)=>{const i=e.getBoundingClientRect();console.log("ðŸš€ ~ scrollToNextItem ~ rect.top: ",i.top),console.log("ðŸš€ ~ scrollToNextItem ~ rect.bottom: ",i.bottom),i.bottom>0&&i.top<s&&(o=c)}),o>=0&&o<a.length-1&&o>0?a[o-1].scrollIntoView({behavior:"smooth",block:"center"}):window.scrollTo(0,0)}function z(){O.forEach(t.equipos,a=>{O.forEach(a,o=>{o&&o.equipo_selec&&(o.equipo_selec.precio_de_lista==0||o.equipo_selec.precio_de_lista==null)&&(o.equipo_selec.precio_de_lista=111)})})}const A=["daItems","valores_total_items","cantidadesItem"],P=["ultra_valor_total"],Z=()=>!(!t.dataOferta.cargo||!t.dataOferta.empresa);function B(){let a=!0;return P.forEach(o=>{if(!t[o])return a=!1,a}),a}function D(){return A.forEach(a=>{if(t[a]){if(t[a].length===0)return!1}else return!1}),!0}const v=()=>{B()&&D()&&Z()?t.post(route("GuardarEditOferta"),{preserveScroll:!0,onSuccess:()=>{},onError:()=>null,onFinish:()=>null}):console.log("Hay campos vacios")};return(a,o)=>(d(),m(g,null,[p(W,{flash:a.$page.props.flash},null,8,["flash"]),l("button",{onClick:j,class:"fixed top-4 left-4 z-50 bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-3 rounded-full shadow-lg","aria-label":"Ir a Valor nulo!"},o[3]||(o[3]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13l-3 3m0 0l-3-3m3 3V8m0 13a9 9 0 110-18 9 9 0 010 18z"})],-1)])),l("button",{onClick:S,class:"fixed top-24 left-4 z-50 bg-amber-500 hover:bg-orange-700 text-white font-bold py-3 px-3 rounded-full shadow-lg","aria-label":"Siguiente item"},o[4]||(o[4]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13l-3 3m0 0l-3-3m3 3V8m0 13a9 9 0 110-18 9 9 0 010 18z"})],-1)])),l("button",{onClick:$,class:"fixed top-4 right-4 z-50 bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-3 rounded-full shadow-lg","aria-label":"Anterior item"},o[5]||(o[5]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"})],-1)])),l("section",lo,[r.mostrarDetalles?(d(),m("div",ro,o[6]||(o[6]=[l("img",{src:"/demco-logo-ultimo.png",alt:"Logo Demco",class:"h-12"},null,-1)]))):_("",!0),l("form",{onSubmit:G(v,["prevent"]),class:"px-16 py-1 2xl:px-8 2xl:py-4"},[p(oo,{modelValue:n(t).dataOferta,"onUpdate:modelValue":o[0]||(o[0]=s=>n(t).dataOferta=s),dataOferta:u.oferta,class:"no-print"},null,8,["modelValue","dataOferta"]),l("div",so,[(d(!0),m(g,null,x(r.factores,(s,e)=>(d(),m("div",{key:e,class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 ease-in-out overflow-hidden"},[l("div",{class:Q([{"bg-indigo-100":e==r.factorSeleccionado-1},"p-4"])},[l("label",{for:`factor-input-${e}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},V(s.title),9,io),k(l("input",{id:`factor-input-${e}`,type:"text","onUpdate:modelValue":c=>r.factores[e].value=c,class:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-base text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:`Ingresa ${s.title.toLowerCase()}`},null,8,no),[[I,r.factores[e].value]])],2)]))),128)),l("div",co,[l("div",uo,[o[7]||(o[7]=l("label",{class:"block font-semibold text-gray-700 dark:text-gray-300 mb-2"}," Factor seleccionado ",-1)),k(l("input",{type:"number",min:"0",max:"5","onUpdate:modelValue":o[1]||(o[1]=s=>r.factorSeleccionado=s),class:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-base text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[I,r.factorSeleccionado,void 0,{number:!0}]])])])]),r.isReady?(d(),m(g,{key:0},[p(C,{initialItems:u.oferta.items.length,onUpdateItems:h,class:"no-print"},null,8,["initialItems"]),(d(!0),m(g,null,x(n(t).daItems,(s,e)=>(d(),y(X,{key:e,item:{...s,equipos:n(t).equipos[e],cantidad:n(t).cantidadesItem[e]},indexItem:e,equipos:n(t).equipos[e],CallOnce_Plantilla:r.CallOnce_Plantilla,factores:r.factores,factorSeleccionado:r.factorSeleccionado,mostrarDetalles:r.mostrarDetalles,plantilla:u.plantilla,onUpdatiItems:T,onCheckzero:F,class:"mb-4"},null,8,["item","indexItem","equipos","CallOnce_Plantilla","factores","factorSeleccionado","mostrarDetalles","plantilla"]))),128)),p(ao,{errors:Object.values(a.$page.props.errors)},null,8,["errors"]),p(C,{initialItems:n(t).daItems.length,onUpdateItems:h,class:"no-print text-center mx-auto w-fit"},null,8,["initialItems"])],64)):_("",!0),l("section",mo,[l("div",po,[l("div",fo,[o[8]||(o[8]=l("h1",{class:"sm:text-xl text-lg font-medium title-font mb-4 text-gray-900"}," Valor total de la oferta ",-1)),l("p",go,V(n(to)(n(t).ultra_valor_total,0,1)),1)])])]),o[10]||(o[10]=l("hr",{class:"border-[1px] border-black my-8 col-span-full"},null,-1)),l("div",bo,[p(eo,{type:"button",class:"px-4 py-2 rounded-2xl no-print",onClick:o[2]||(o[2]=s=>r.mostrarDetalles=!r.mostrarDetalles)},{default:J(()=>o[9]||(o[9]=[K(" Alternar detalles ")])),_:1,__:[9]})]),r.EquipsOnZero?_("",!0):(d(),y(Y,{key:1,ruta:"Oferta.index",formProcessing:n(t).processing,onCreate:v,class:"no-print mb-20 pb-10"},null,8,["formProcessing"]))],32)])],64))}};export{zo as default};
