import{Q as U,T as A,l as q,k as P,m as T,A as $,f as p,o as i,g as m,b as t,a as _,c as h,u as r,F as E,p as V,t as n,w as M,e as B,d as L,n as R}from"./app-BhGvptmL.js";/* empty css             *//* empty css                   */import{r as G,_ as H}from"./Newitem-BWoElxws.js";import k from"./CerrarYguardar-CkJn2v-6.js";import"./vue-select.es-CcZCZQ2N.js";import N from"./Add_Sub_items-D41dib_0.js";import Q from"./formOferta-D9HQxmjU.js";import{n as D,f as J}from"./global-Dn-lfq_U.js";import{_ as K}from"./PrimaryButton-BkUg86Bs.js";import{E as W}from"./ErroresNuevaOferta-BPRT1ZWQ.js";import"./TextInput-XsIzkty-.js";import"./Add_Sub_equipos-BztWUKjl.js";import"./InputError-Ck0A_nV9.js";import"./PencilIcon-KSwtZsAy.js";import"./SecondaryButton-sXq2m4Kv.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"space-y-6"},Y={key:0,class:"flex justify-center mt-6 mb-2"},ee={key:0,class:"flex flex-col text-center w-full mb-1"},te={class:"text-gray-600 body-font"},ae={class:"container mx-auto"},se={class:"flex flex-col text-center mx-auto w-full max-w-[300px] bg-white py-4 mt-12 mb-20 rounded-xl border border-collapse border-green-400"},oe={class:"text-2xl lg:w-2/3 mx-auto leading-relaxed"},re={class:"flex justify-center text-center my-4"},le={class:"w-full my-8 px-2 2xl:px-16 max-h-[330px] overflow-y-scroll no-print"},ie={class:"overflow-x-scroll"},ne={class:"w-full divide-y-2 divide-gray-200"},ce={class:"px-3 py-2 whitespace-nowrap"},pe={class:"px-3 py-2 whitespace-nowrap"},de={class:"px-3 py-2 whitespace-nowrap"},me={class:"px-3 py-2 whitespace-nowrap"},ue={class:"px-3 py-2 whitespace-nowrap"},fe={class:"px-3 py-2 whitespace-nowrap"},_e={class:"px-3 py-2 whitespace-nowrap"},he={class:"px-3 py-2 whitespace-nowrap"},Se={__name:"NuevaOferta2",props:{numberPermissions:Number,ultimoIdMasUno:Number},setup(z){U();const g=z,e=A({dataOferta:{codigo_oferta:"CD250",descripcion:"DEMCO INGENIERÍA, es una empresa dinámica dedicada al diseño, construcción y puesta en servicio de subestaciones y tableros eléctricos en media y baja tensión, desarrollando proyectos con altas especificaciones en ingeniería, en alianza con reconocidas empresas del sector eléctrico. Entregamos a nuestros clientes soluciones completas e integrales respaldados por procesos de ingeniería y automatización, ágiles y con importantes alianzas con reconocidas empresas del sector. Somos una empresa Colombiana con proyección hacia el futuro, contamos con productos de calidad, precios competitivos, recurso humano calificado, capacidad operativa y respuesta oportuna a nuestros cliente.",cargo:"ANALISTA DE OFERTA",empresa:"",ciudad:"",proyecto:""},equipos:[],daItems:[],valores_total_items:[],cantidadesItem:[],ultra_valor_total:0}),l=q({params:{pregunta:""},mostrarDetalles:!0,EquipsOnZero:!1,hijosZeroFlags:{}});P(()=>{g.numberPermissions>9&&(G(e),e.dataOferta.empresa="empresa ejemplo",e.dataOferta.ciudad="ciudad ejemplo",e.dataOferta.proyecto="proyecto ejemplo")}),T(()=>{g.show});function y(){e.ultra_valor_total=0,e.valores_total_items.forEach(o=>{e.ultra_valor_total+=o||0})}function C({equipos:o,valorItemUnitario:a,TotalItem:u,indexItem:s,cantidadItem:c,valor_total_item:f,daitem:Z}){e.daItems[s]=Z||{equipo_selec:null,cantidad:1},e.equipos[s]=o,e.valorItemUnitario=a,e.TotalItem=u;let O=0;o.forEach(d=>{d.equipo_selec&&(O=d.cantidad*d.equipo_selec.precio_de_lista,O!==d.subtotalequip&&console.warn("🚀 ~ actualizarValoresItems ~ equipo.equipo_selec.precio_de_lista: ",d.equipo_selec))}),s>=e.valores_total_items.length&&(e.valores_total_items.length=s+1),e.cantidadesItem[s]=c,e.valores_total_items[s]=f||0,y()}function w(o){for(;e.daItems.length<o;)e.daItems.push({equipo_selec:null,cantidad:1});for(;e.daItems.length>o;)e.daItems.pop(),e.valores_total_items.pop();y()}function j({index:o,isZero:a}){l.hijosZeroFlags[o]=a,console.log("🚀 ~ actualizarEquipsOnZero ~ data.hijosZeroFlags: ",l.hijosZeroFlags),l.EquipsOnZero=Object.values(l.hijosZeroFlags).includes(!0)}const F=["daItems","valores_total_items","cantidadesItem"],S=["ultra_valor_total"];$(null);function v(){return!(!e.dataOferta.cargo||!e.dataOferta.empresa)}function b(){let o=!0;return S.forEach(a=>{if(!e[a])return o=!1,o}),o}function I(){return F.forEach(o=>{if(e[o]){if(e[o].length===0)return!1}else return!1}),!0}const x=()=>{console.log("Vacios:: ",b()),console.log("VectoresVacios:: ",I()),console.log("FormInicial:: ",v()),b()&&I()&&v()?e.post(route("GuardarNuevaOferta"),{preserveScroll:!0,onSuccess:()=>{},onError:()=>null,onFinish:()=>null}):console.log("Hay campos vacios")};return(o,a)=>{var u;return i(),p("section",X,[l.mostrarDetalles?(i(),p("div",Y,a[2]||(a[2]=[t("img",{src:"/demco-logo-ultimo.png",alt:"Logo Demco",class:"h-12"},null,-1)]))):m("",!0),t("form",{onSubmit:L(x,["prevent"]),class:"px-16 py-1 2xl:px-36 2xl:pb-2 print-container"},[l.mostrarDetalles?(i(),p("div",ee)):m("",!0),_(Q,{textoIntroducturio:o.textoIntroducturio,modelValue:r(e).dataOferta,"onUpdate:modelValue":a[0]||(a[0]=s=>r(e).dataOferta=s),class:"no-print"},null,8,["textoIntroducturio","modelValue"]),_(N,{initialItems:r(e).daItems.length,onUpdateItems:w,class:"no-print"},null,8,["initialItems"]),(i(!0),p(E,null,V(r(e).daItems,(s,c)=>{var f;return i(),h(H,{key:c,valorUnitario:((f=s.equipo_selec)==null?void 0:f.Valor_Unit)??0,initialCantidad:s.cantidad??1,daitem:s,indexItem:c,losSelect:o.losSelect,mostrarDetalles:l.mostrarDetalles,onUpdatiItems:C,onCheckzero:j,class:"grid grid-cols-2 gap-4 mb-4"},null,8,["valorUnitario","initialCantidad","daitem","indexItem","losSelect","mostrarDetalles"])}),128)),_(W,{errors:Object.values(o.$page.props.errors)},null,8,["errors"]),r(e).daItems.length>2?(i(),h(N,{key:1,initialItems:r(e).daItems.length,onUpdateItems:w,class:"no-print text-center mx-auto w-fit"},null,8,["initialItems"])):m("",!0),t("section",te,[t("div",ae,[t("div",se,[a[3]||(a[3]=t("h1",{class:"sm:text-xl text-lg font-medium title-font mb-4 text-gray-900"}," Valor total de la oferta ",-1)),t("p",oe,n(r(D)(r(e).ultra_valor_total,0,1)),1)])])]),a[6]||(a[6]=t("hr",{class:"border-[1px] border-black my-8 col-span-full"},null,-1)),t("div",re,[_(K,{type:"button",class:"px-4 py-2 rounded-2xl no-print",onClick:a[1]||(a[1]=s=>l.mostrarDetalles=!l.mostrarDetalles)},{default:M(()=>a[4]||(a[4]=[B(" Alternar detalles ")])),_:1,__:[4]})]),l.EquipsOnZero?m("",!0):(i(),h(k,{key:2,ruta:"Oferta.index",formProcessing:r(e).processing,onCreate:x,class:"no-print"},null,8,["formProcessing"])),a[7]||(a[7]=t("h2",{class:"mx-12 text-center text-2xl font-medium text-gray-900 dark:text-gray-100 mt-36 no-print"}," Últimas actualizaciones de equipos (Sin precio de lista) ",-1)),t("div",le,[t("div",ie,[t("table",ne,[a[5]||(a[5]=t("thead",{class:"ltr:text-left rtl:text-right"},[t("tr",{class:"*:font-medium *:text-gray-900 *:first:sticky *:first:left-0 *:first:bg-white"},[t("th",{class:"px-3 py-2 whitespace-nowrap"},"Código"),t("th",{class:"px-3 py-2 whitespace-normal"},"Descripción"),t("th",{class:"px-3 py-2 whitespace-nowrap"},"Precio de Lista"),t("th",{class:"px-3 py-2 whitespace-nowrap"},"Tipo Fabricante"),t("th",{class:"px-3 py-2 whitespace-nowrap"},"Referencia Fabricante"),t("th",{class:"px-3 py-2 whitespace-nowrap"},"Marca"),t("th",{class:"px-3 py-2 whitespace-nowrap"},"Unidad de Compra"),t("th",{class:"px-3 py-2 whitespace-nowrap"},"Última Actualización")])],-1)),(i(!0),p(E,null,V((u=g.losSelect)==null?void 0:u.ultimosEquipos,(s,c)=>(i(),p("tbody",{key:c,class:"divide-y divide-gray-200"},[t("tr",{class:R(["*:text-gray-900 first:sticky first:left-0 first:bg-white first:font-medium hover:bg-red-300 hover:dark:bg-gray-900/20",c%2===0?"bg-gray-200":"bg-white"])},[t("td",ce,n(s.codigo),1),t("td",pe,n(s.descripcion),1),t("td",de,n(r(D)(s.precio_de_lista,0,1)),1),t("td",me,n(s.tipo_fabricante),1),t("td",ue,n(s.referencia_fabricante),1),t("td",fe,n(s.marca),1),t("td",_e,n(s.unidad_de_compra),1),t("td",he,n(r(J)(s.fecha_actualizacion)),1)],2)]))),128))])])]),l.EquipsOnZero?m("",!0):(i(),h(k,{key:3,ruta:"Oferta.index",formProcessing:r(e).processing,onCreate:x,class:"no-print"},null,8,["formProcessing"]))],32)])}}};export{Se as default};
